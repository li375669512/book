<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>BSD Socket</title>
<title>Network Component: BSD Socket</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Network Component
   &#160;<span id="projectnumber">Version 6.7.7</span>
   </div>
   <div id="projectbrief">MDK-Professional Middleware for IP Networking</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('using_network_sockets_bsd.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">BSD Socket </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The BSD sockets application programming interface (API) is a set of standard function calls that can be used in an application. They allow programmers to add Internet communication to their products.</p>
<p>A client/server architecture is mandatory for BSD sockets. Using <a class="el" href="group__tcp__routines.html">TCP</a>, a host listens for incoming connection requests. Upon accepting an incoming request, data can be transferred between the hosts. <a class="el" href="group__udp__routines.html">UDP</a> can also be used to establish a connection.</p>
<p>As you can see, BSD sockets is not a stand-alone socket solution, but it is an API that relies on other socket communication for data exchange. Thus, you always need to add <a class="el" href="group__tcp__routines.html">TCP</a> and <a class="el" href="group__udp__routines.html">UDP</a> to your project if you wish to use BSD sockets.</p>
<h1><a class="anchor" id="using_network_sockets_bsd_com_flow"></a>
Communication Flow</h1>
<p>The image below explains the basic communication flow using BSD sockets with TCP.</p>
<div class="image">
<img src="NW_Diagrams.png" alt="NW_Diagrams.png"/>
<div class="caption">
Flow Diagram for BSD Sockets Communication using TCP</div></div>
 <h2><a class="anchor" id="using_network_sockets_bsd_server"></a>
BSD Server</h2>
<p>The BSD server creates a <a class="el" href="group__bsd__routines.html#gabd21dff339393ec8e83b439d1120df71">socket</a>, uses <a class="el" href="group__bsd__routines.html#ga03a7134a282d45095ea30edb8e1cd076">bind</a> to attach that socket to a port, and configures it as a <a class="el" href="group__bsd__routines.html#ga7005ffbeeff92be5394ff3244da79028">listening</a> socket. This allows the server to receive incoming connection requests. Afterwards, <a class="el" href="group__bsd__routines.html#ga18e88467cfdbc3c361d53b9f928a87ab">accept</a> is called, which will block the socket, until an incoming connection request is received. When <a class="el" href="group__bsd__routines.html#ga18e88467cfdbc3c361d53b9f928a87ab">accept</a> returns, the <a class="el" href="group__bsd__routines.html#struct_s_o_c_k_a_d_d_r">SOCKADDR</a> structure will have been filled out with the originating IP Address and port of the incoming connection. Then, <a class="el" href="group__bsd__routines.html#ga18e88467cfdbc3c361d53b9f928a87ab">accept</a> creates a new socket, which is then used to <a class="el" href="group__bsd__routines.html#gae13b0fcffdc4f2c181a1def0b641ead4">receive</a> data until the connection is <a class="el" href="group__bsd__routines.html#gad272c8891ecce101c35bf18e3dc03d38">closed</a> by the other side.</p>
<p><b>Code Example for the BSD Server</b> </p>
<div class="fragment"><div class="line"><span class="comment">//----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//Thread &#39;Server&#39;: BSD Server socket process</span></div>
<div class="line"><span class="comment">//----------------------------------------------------------------------------</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> Server (<span class="keywordtype">void</span> <span class="keyword">const</span> *arg) {</div>
<div class="line">  <a class="code" href="group__bsd__routines.html#struct_s_o_c_k_a_d_d_r___i_n">SOCKADDR_IN</a> addr;</div>
<div class="line">  <span class="keywordtype">int</span> sock, sd, res;</div>
<div class="line">  <span class="keywordtype">int</span> type = (int)arg;</div>
<div class="line">  <span class="keywordtype">char</span> dbuf[4];</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span> (1) {</div>
<div class="line">    sock = <a class="code" href="group__bsd__routines.html#gabd21dff339393ec8e83b439d1120df71">socket</a> (<a class="code" href="rl__net_8h.html#a9930604d0e32588eae76f43ca38e7826">AF_INET</a>, type, 0);</div>
<div class="line"></div>
<div class="line">    addr.<a class="code" href="group__bsd__routines.html#a17c017619a9612c083063a3438ac4b5e">sin_port</a>        = <a class="code" href="rl__net_8h.html#af3a256b18d0645af51564e63fec1bbbb">htons</a>(PORT_NUM);</div>
<div class="line">    addr.<a class="code" href="group__bsd__routines.html#a321ed882a4b4cd66d1b9ad64ababd67e">sin_family</a>      = <a class="code" href="rl__net_8h.html#a3f5da0b5be27fe31ec7cc11bfa8d1a25">PF_INET</a>;</div>
<div class="line">    addr.<a class="code" href="group__bsd__routines.html#a92b552b33b68a46c97a8d27a13a8bfb6">sin_addr</a>.s_addr = <a class="code" href="rl__net_8h.html#a5d1940045dc2e7de552f3d4ff13a74ab">INADDR_ANY</a>;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__bsd__routines.html#ga03a7134a282d45095ea30edb8e1cd076">bind</a> (sock, (<a class="code" href="group__bsd__routines.html#struct_s_o_c_k_a_d_d_r">SOCKADDR</a> *)&amp;addr, <span class="keyword">sizeof</span>(addr));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (type == <a class="code" href="rl__net_8h.html#a249394484f9410a2e3f8eba24657feb9">SOCK_STREAM</a>) {</div>
<div class="line">      <a class="code" href="group__bsd__routines.html#ga7005ffbeeff92be5394ff3244da79028">listen</a> (sock, 1);</div>
<div class="line">      sd = <a class="code" href="group__bsd__routines.html#ga18e88467cfdbc3c361d53b9f928a87ab">accept</a> (sock, NULL, NULL);</div>
<div class="line">      <a class="code" href="group__bsd__routines.html#gad272c8891ecce101c35bf18e3dc03d38">closesocket</a> (sock);</div>
<div class="line">      sock = sd;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">      res = <a class="code" href="group__bsd__routines.html#gae13b0fcffdc4f2c181a1def0b641ead4">recv</a> (sock, dbuf, <span class="keyword">sizeof</span> (dbuf), 0);</div>
<div class="line">      <span class="keywordflow">if</span> (res &lt;= 0) {</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span> (dbuf[0] == BLINKLED) {</div>
<div class="line">        LED_Out (dbuf[1]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="group__bsd__routines.html#gad272c8891ecce101c35bf18e3dc03d38">closesocket</a> (sock);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="using_network_sockets_bsd_client"></a>
BSD Client</h2>
<p>The BSD Client creates a <a class="el" href="group__bsd__routines.html#gabd21dff339393ec8e83b439d1120df71">socket</a> calls <a class="el" href="group__bsd__routines.html#gadced863676ed93d1334ba8abef937dd1">connect</a>, because TCP requires a negotiated connection. Afterwards, <a class="el" href="group__bsd__routines.html#ga27f7859e634a2cd0ab98219b5092f7f7">send</a> is called to send the data to the server. Note that <a class="el" href="group__bsd__routines.html#ga03a7134a282d45095ea30edb8e1cd076">bind</a> is never called, because the stack will pick a random port and an appropriate IP address. To finish the communication, the client calls <a class="el" href="group__bsd__routines.html#gad272c8891ecce101c35bf18e3dc03d38">closesocket</a>.</p>
<p><b>Code Example for the BSD Client</b> </p>
<div class="fragment"><div class="line"><span class="comment">//----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//  Thread &#39;Client&#39;: BSD Client socket process</span></div>
<div class="line"><span class="comment">//----------------------------------------------------------------------------</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> Client (<span class="keywordtype">void</span> <span class="keyword">const</span> *arg) {</div>
<div class="line">  <a class="code" href="group__bsd__routines.html#struct_s_o_c_k_a_d_d_r___i_n">SOCKADDR_IN</a> addr;</div>
<div class="line">  <span class="keywordtype">int</span> sock, res;</div>
<div class="line">  <span class="keywordtype">char</span> dbuf[4];</div>
<div class="line">  uint8_t p2val,lshf;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span> (1) {</div>
<div class="line">    sock = <a class="code" href="group__bsd__routines.html#gabd21dff339393ec8e83b439d1120df71">socket</a> (<a class="code" href="rl__net_8h.html#a9930604d0e32588eae76f43ca38e7826">AF_INET</a>, SOCKTYPE, 0);</div>
<div class="line"></div>
<div class="line">    addr.<a class="code" href="group__bsd__routines.html#a17c017619a9612c083063a3438ac4b5e">sin_port</a>      = <a class="code" href="rl__net_8h.html#af3a256b18d0645af51564e63fec1bbbb">htons</a>(PORT_NUM);</div>
<div class="line">    addr.<a class="code" href="group__bsd__routines.html#a321ed882a4b4cd66d1b9ad64ababd67e">sin_family</a>    = <a class="code" href="rl__net_8h.html#a3f5da0b5be27fe31ec7cc11bfa8d1a25">PF_INET</a>;</div>
<div class="line">    addr.<a class="code" href="group__bsd__routines.html#a92b552b33b68a46c97a8d27a13a8bfb6">sin_addr</a>.s_b1 = IP1;</div>
<div class="line">    addr.<a class="code" href="group__bsd__routines.html#a92b552b33b68a46c97a8d27a13a8bfb6">sin_addr</a>.s_b2 = IP2;</div>
<div class="line">    addr.<a class="code" href="group__bsd__routines.html#a92b552b33b68a46c97a8d27a13a8bfb6">sin_addr</a>.s_b3 = IP3;</div>
<div class="line">    addr.<a class="code" href="group__bsd__routines.html#a92b552b33b68a46c97a8d27a13a8bfb6">sin_addr</a>.s_b4 = IP4;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__bsd__routines.html#gadced863676ed93d1334ba8abef937dd1">connect</a> (sock, (<a class="code" href="group__bsd__routines.html#struct_s_o_c_k_a_d_d_r">SOCKADDR</a> *)&amp;addr, <span class="keyword">sizeof</span> (addr));</div>
<div class="line"></div>
<div class="line">    lshf  = 1;</div>
<div class="line">    p2val = 0x01;</div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">      <span class="comment">// Shift the LEDs</span></div>
<div class="line">      LED_Out (p2val);</div>
<div class="line">      p2val = lshf ? (p2val &lt;&lt; 1) : (p2val &gt;&gt; 1);</div>
<div class="line">      <span class="keywordflow">if</span> (p2val == 0x80) lshf = 0;</div>
<div class="line">      <span class="keywordflow">if</span> (p2val == 0x01) lshf = 1;</div>
<div class="line">    </div>
<div class="line">      <span class="comment">// Send the data to LED Server.</span></div>
<div class="line">      dbuf[0] = BLINKLED;</div>
<div class="line">      dbuf[1] = p2val;</div>
<div class="line">      res = <a class="code" href="group__bsd__routines.html#ga27f7859e634a2cd0ab98219b5092f7f7">send</a> (sock, (<span class="keywordtype">char</span> *)&amp;dbuf, 2, 0);</div>
<div class="line">      <span class="keywordflow">if</span> (res &lt; 0) {</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      osDelay (100 * SPEED);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="group__bsd__routines.html#gad272c8891ecce101c35bf18e3dc03d38">closesocket</a> (sock);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="using_network_sockets_bsd_func"></a>
BSD Socket Functions</h1>
<p>The following table shows the available API functions for BSD sockets.</p>
<table class="doxtable">
<tr>
<th>Function </th><th>Description  </th></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#ga18e88467cfdbc3c361d53b9f928a87ab">accept</a> </td><td>Accepts a connection request queued for a listening socket. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#ga03a7134a282d45095ea30edb8e1cd076">bind</a> </td><td>Assigns a name (local address) to a socket. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#gad272c8891ecce101c35bf18e3dc03d38">closesocket</a> </td><td>Closes an existing socket and releases a socket descriptor. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#gadced863676ed93d1334ba8abef937dd1">connect</a> </td><td>Establishes connection between the endpoints on stream sockets. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#gad5213a5aefe3d46dc5aa0c5813c06b1d">gethostbyname</a> </td><td>Retrieves host address corresponding to a host name from a host database. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#ga9c2820e49f50f3757136f8bd928ab279">getpeername</a> </td><td>Retrieves the address of the peer to which a socket is connected. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#gaccbeb567d8c775d4405dc556433bb592">getsockname</a> </td><td>Retrieves the local address of the socket. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#ga0b42eb9e32b55aff7130ef48afd8b885">ioctlsocket</a> </td><td>Sets or retrieves some of the operating parameters on a socket. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#ga7005ffbeeff92be5394ff3244da79028">listen</a> </td><td>Sets the socket in a listen mode. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#gae13b0fcffdc4f2c181a1def0b641ead4">recv</a> </td><td>Receives incoming data that has been queued for a socket. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#gac6b00a29e8f1664d7ba4a70bfb92d9db">recvfrom</a> </td><td>Receives incoming data on a datagram socket. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#ga27f7859e634a2cd0ab98219b5092f7f7">send</a> </td><td>Sends outgoing data on a socket. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#gac238092843e59c729b6904b18eeeff77">sendto</a> </td><td>Sends outgoing data on a datagram socket to destination address. </td></tr>
<tr>
<td><a class="el" href="group__bsd__routines.html#gabd21dff339393ec8e83b439d1120df71">socket</a> </td><td>Creates a communication socket. </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The BSD sockets implementation in the Network Component is not a complete implementation of the BSD API.</li>
<li>The BSD functions are <b>thread</b> <b>safe</b> and must be used with an CMSIS-RTOS.</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="using_network_sockets_bsd_conf"></a>
BSD Socket Configuration</h1>
<div class="image">
<img src="net_config_bsd_h.png" alt="net_config_bsd_h.png"/>
<div class="caption">
BSD Socket Configuration File</div></div>
<p> The BSD sockets configuration file <b>Net_Config_BSD.h</b> contains the following settings:</p>
<ul>
<li><b>Number of BSD Sockets</b> specifies the number of available BSD sockets. This number specifies the maximum number of simultaneously opened connections.</li>
<li><b>Number of Streaming Server Sockets</b> specifies the number of streaming (TCP) server sockets. The server sockets listen for an incoming connection from the client.</li>
<li><b>Receive Timeout in seconds</b> is the timeout, after which the receiving socket returns to blocking mode.</li>
<li>The <b>Hostname Resolver</b> switch enables or disables the Berkeley style hostname resolver. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="using_network_components.html">Using Network Components</a></li><li class="navelem"><a class="el" href="using_network_sockets.html">Sockets</a></li>
    <li class="footer">Generated on Tue May 25 2021 13:57:56 for Network Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
