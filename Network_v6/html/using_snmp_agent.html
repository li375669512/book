<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SNMP Agent</title>
<title>Network Component: SNMP Agent</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Network Component
   &#160;<span id="projectnumber">Version 6.7.7</span>
   </div>
   <div id="projectbrief">MDK-Professional Middleware for IP Networking</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('using_snmp_agent.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SNMP Agent </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Simple Network Management Protocol (SNMP)</b> is mainly used in network management systems to monitor network-attached devices for conditions that warrant administrative attention. It is the most popular network management protocol in the TCP/IP protocol suite.</p>
<p>SNMP is a simple request/response protocol that communicates management information between two types of SNMP software entities: SNMP <b>managers</b> and SNMP <b>agents</b>. The following picture shows an exemplary setup:</p>
<div class="image">
<img src="snmp_overview.png" alt="snmp_overview.png"/>
</div>
<p>In summary, SNMP performs the following operations:</p>
<ul>
<li>The <b>GET</b> operation receives a specific value about a managed object, such as the available hard disk space from the agent's MIB.</li>
<li>The <b>GET-NEXT</b> operation returns the "next" value by traversing the MIB tree of managed object variables.</li>
<li>The <b>SET</b> operation changes the value of a managed object's variable. Only variables whose object definition allows read/write access can be changed.</li>
<li>The <b>Trap</b> operation sends a message to the Management Station when a change occurs in a managed object, and that change is important enough to send an alert message.</li>
</ul>
<p>The SNMP Agent validates each request from a SNMP manager before responding to the request, by verifying that the manager belongs to a SNMP community with access privileges to the agent. A SNMP community is a logical relationship between a SNMP agent and one or more SNMP managers. The community has a name, and all members of a community have the same access privileges: either read-only or read-write.</p>
<p>The SNMP Agent in the Network Component is an optimized and compact implementation for embedded systems. <b>Check:</b> Currently it implements SNMP version 1.</p>
<p>The following functions are included in the Network Component library rl_net.h:</p>
<ul>
<li><a class="el" href="group__snmp__routines.html#gafb6789902c478645eca2253c1c7a6341">snmp_trap</a> - send a trap to the manager.</li>
<li><a class="el" href="group__snmp__routines.html#ga530c9801cae98b8d5a86c19aeafa8af8">snmp_set_community</a> - change SNMP community to a new community.</li>
</ul>
<h1><a class="anchor" id="mib_database"></a>
MIB Database</h1>
<p>The data base controlled by the SNMP Agent is referred to as the <b>SNMP Management Information Base (MIB)</b>. It is a standard set of statistical and control values. SNMP allows the extension of these standard values with values specific to a particular agent through the use of private MIBs.</p>
<p>The definitions of MIB variables supported by a particular agent are incorporated in descriptor files, written in <b>Abstract Syntax Notation (ASN.1)</b> format, made available to network management client programs so that they can become aware of these MIB variables and their usage.</p>
<p>The MIB variables are referred to as MIB <b>Object Identifiers (OIDs)</b>. OID names are hierarchy structured and unique. SNMP uses the OID to identify objects on each network element (device running SNMP agent) that can be managed using SNMP.</p>
<h1><a class="anchor" id="mib_interface"></a>
MIB Interface</h1>
<p>The SNMP Agent manages MIB variables that are located in the <b>SNMP_Agent_MIB.c</b> template file. To add the file to your project, simply right-click on the Source group, select <b>Add Net Item to Group</b>, then click on <b>User Code Template</b> and scroll in the template files list until you find the <b>SNMP Agent</b> template (you will find a listing <a class="el" href="group__snmp__routines.html#anchor_SNMP_Agent_MIB">here</a>). The <b>SNMP_Agent_MIB.c</b> file has implemented a scaled-down <b>MIB-II</b> Management Information Base. Only the System <b>MIB</b> is defined by default. The user might expand this table by adding his own MIB variables.</p>
<p>The user can register a callback function with a MIB variable. This function gets called, when the SNMP Manager accesses the MIB variable. This concept allows the SNMP Manager to control the SNMP Agent system. For example to change LED outputs, to write text on embedded LCD module, to read push buttons or analog inputs, etc.</p>
<h1><a class="anchor" id="mib_entry"></a>
MIB Entry</h1>
<p>The SNMP MIB entry information structure <a class="el" href="_s_n_m_p___agent___m_i_b_8c.html#ab75a4b510f171e5230edf525c9b2215d">snmp_mib</a> describes the MIB variable. The SNMP Agent uses this description to process local MIB variables. This structure is defined as follows: </p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="_s_n_m_p___agent___m_i_b_8c.html#ab75a4b510f171e5230edf525c9b2215d">snmp_mib</a> {</div>
<div class="line">  uint8_t  Type;                        <span class="comment">// Object Type</span></div>
<div class="line">  uint8_t  OidLen;                      <span class="comment">// Object ID length</span></div>
<div class="line">  uint8_t  Oid[<a class="code" href="rl__net_8h.html#a252cc29e7614d0a7628082190901ec72">MIB_OID_SIZE</a>];           <span class="comment">// Object ID value</span></div>
<div class="line">  uint8_t  ValSz;                       <span class="comment">// Size of a variable</span></div>
<div class="line">  <span class="keywordtype">void</span>     *Val;                        <span class="comment">// Pointer to a variable</span></div>
<div class="line">  void     (*cb_func)(<span class="keywordtype">int</span> mode);        <span class="comment">// Write/Read event callback function</span></div>
<div class="line">} <span class="keyword">const</span> <a class="code" href="group__snmp__routines.html#struct_s_n_m_p___m_i_b">SNMP_MIB</a>;</div>
</div><!-- fragment --><p> The components of MIB_ENTRY structure are:</p>
<ul>
<li>the <em>Type</em> defines the MIB variable type: <table class="doxtable">
<tr>
<th>MIB Type </th><th>Description </th><th>Size  </th></tr>
<tr>
<td>MIB_INTEGER </td><td>Signed Integer </td><td>1, 2 or 4 bytes </td></tr>
<tr>
<td>MIB_OCTET_STR </td><td>Octet String entry </td><td>max. 110 characters </td></tr>
<tr>
<td>MIB_OBJECT_ID </td><td>Object Identifier entry </td><td>max. 17 bytes </td></tr>
<tr>
<td>MIB_IP_ADDR </td><td>IP Address entry </td><td>4 bytes </td></tr>
<tr>
<td>MIB_COUNTER </td><td>Counter entry </td><td>1, 2 or 4 bytes </td></tr>
<tr>
<td>MIB_GAUGE </td><td>Gauge entry </td><td>1, 2 or 4 bytes </td></tr>
<tr>
<td>MIB_TIME_TICKS </td><td>Time Ticks entry </td><td>4 bytes </td></tr>
</table>
The <em>Type</em> component may be OR-ed with the <b>MIB_ATR_RO</b> read-only attribute. A read-only variable can not be changed by the SNMP Manager.</li>
<li>the OID specifies the Object Identification Name of the variable. It is length encoded:<ul>
<li><em>OidLen</em> specifies the length of the <em>Oid</em>[] array.</li>
<li><em>Oid</em>[MIB_OID_SIZE] array specifies the OID name - a length encoded binary array.</li>
</ul>
</li>
<li><em>Val</em> specifies the Pointer to the variable and its Size:<ul>
<li><em>ValSz</em> specifies the size of Val variable.</li>
<li><em>Val</em> is a pointer to the actual variable.</li>
</ul>
</li>
<li>the <em>cb_func</em> specifies a callback function which is called, when the variable is accessed by SNMP Manager. The callback function is not registered, when the value of <em>cb_func</em> is NULL. The argument <em>mode</em> of the callback function specifies the access mode of SNMP Manager: <table class="doxtable">
<tr>
<th>Mode </th><th>Type of Access  </th></tr>
<tr>
<td>MIB_READ </td><td>Reads a MIB variable. </td></tr>
<tr>
<td>MIB_WRITE</td><td>Writes to a MIB variable. </td></tr>
</table>
</li>
</ul>
<h1><a class="anchor" id="mib_table"></a>
MIB Table</h1>
<p>The <b>snmp_table</b> table is defined as an array. The components of this array are of type <a class="el" href="_s_n_m_p___agent___m_i_b_8c.html#ab75a4b510f171e5230edf525c9b2215d">snmp_mib</a>. </p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="_s_n_m_p___agent___m_i_b_8c.html#ab75a4b510f171e5230edf525c9b2215d">snmp_mib</a> <a class="code" href="_s_n_m_p___agent___m_i_b_8c.html#ab75a4b510f171e5230edf525c9b2215d">snmp_mib</a>[] = {</div>
<div class="line">  <span class="comment">// ---------- System MIB -----------</span></div>
<div class="line">  <span class="comment">// SysDescr Entry</span></div>
<div class="line">  { <a class="code" href="rl__net_8h.html#a6a09b685401fd19851fdb74e423c6d52">MIB_OCTET_STR</a> | <a class="code" href="rl__net_8h.html#a6cb6f3df80a9f560c4cbe261641eaea1">MIB_ATR_RO</a>,</div>
<div class="line">    8, {<a class="code" href="rl__net_8h.html#a524c32f35c707a1bf6b256c3d86b5ee0">MIB_OID0</a>(1,3), 6, 1, 2, 1, 1, 1, 0},</div>
<div class="line">    <a class="code" href="rl__net_8h.html#ad944c38266e39ebe98af66c395c2a131">MIB_STR</a>(<span class="stringliteral">&quot;Embedded System SNMP V1.0&quot;</span>),</div>
<div class="line">    NULL },</div>
<div class="line">  <span class="comment">// SysObjectID Entry</span></div>
<div class="line">  { <a class="code" href="rl__net_8h.html#a3d6543f237b5832974db3cb492355571">MIB_OBJECT_ID</a> | <a class="code" href="rl__net_8h.html#a6cb6f3df80a9f560c4cbe261641eaea1">MIB_ATR_RO</a>,</div>
<div class="line">    8, {<a class="code" href="rl__net_8h.html#a524c32f35c707a1bf6b256c3d86b5ee0">MIB_OID0</a>(1,3), 6, 1, 2, 1, 1, 2, 0},</div>
<div class="line">    <a class="code" href="rl__net_8h.html#ad944c38266e39ebe98af66c395c2a131">MIB_STR</a>(<span class="stringliteral">&quot;\x2b\x06\x01\x02\x01\x01\x02\x00&quot;</span>),</div>
<div class="line">    NULL },</div>
<div class="line">  <span class="comment">// SysUpTime Entry</span></div>
<div class="line">  { <a class="code" href="rl__net_8h.html#aed3ad4b2d6a8cdca482fc98c423cef8f">MIB_TIME_TICKS</a> | <a class="code" href="rl__net_8h.html#a6cb6f3df80a9f560c4cbe261641eaea1">MIB_ATR_RO</a>,</div>
<div class="line">    8, {<a class="code" href="rl__net_8h.html#a524c32f35c707a1bf6b256c3d86b5ee0">MIB_OID0</a>(1,3), 6, 1, 2, 1, 1, 3, 0},</div>
<div class="line">    4, &amp;<a class="code" href="_s_n_m_p___agent___m_i_b_8c.html#a12860c2aad0b0936c54684c3972c21f9">snmp_SysUpTime</a>,</div>
<div class="line">    NULL },</div>
<div class="line">    ..</div>
<div class="line">}</div>
</div><!-- fragment --><p> In the following example, we will construct a MIB variable entry <b>LedOut</b>. It will allow the SNMP Manager to control LEDs on an evaluation board.</p>
<p>The MIB variable <b>type</b> is Integer. An uint8_t variable is sufficient, because the LED port is 8-bit: </p>
<div class="fragment"><div class="line"><span class="comment">// LedOut Entry</span></div>
<div class="line">{ <a class="code" href="rl__net_8h.html#a92acf1076e5ce592999db4170e38b2c5">MIB_INTEGER</a>,</div>
</div><!-- fragment --><p>The OID reference is 1.3.6.1.3.1.0. It is defined in the <b>Experimental</b> MIB branch of the MIB tree: </p>
<div class="fragment"><div class="line">6, {<a class="code" href="rl__net_8h.html#a524c32f35c707a1bf6b256c3d86b5ee0">MIB_OID0</a>(1,3), 6, 1, 3, 1, 0},</div>
</div><!-- fragment --><ul>
<li>the first byte defines the <b>length</b> of the OID name,</li>
<li>macro <b>MIB_OID0</b> calculates the first byte of OID value from 1st and 2nd address byte,</li>
<li>the value of an OID address byte must be less than 128, otherwise an <b>extended</b> encoding must be used.</li>
</ul>
<p>The variable size and location is described with the help of <b>MIB_INT</b> macro: </p>
<div class="fragment"><div class="line"><a class="code" href="rl__net_8h.html#afa16c5468f05022f71c6abe68d506466">MIB_INT</a>(LedOut),</div>
</div><!-- fragment --><p> The following macros are defined: </p>
<table class="doxtable">
<tr>
<th>Macro </th><th>Variable Definition  </th></tr>
<tr>
<td>MIB_STR</td><td>Octet String size and location. </td></tr>
<tr>
<td>MIB_INT</td><td>Signed or Unsigned Integer size and location. </td></tr>
<tr>
<td>MIB_IP </td><td>IP Address size and location. </td></tr>
</table>
<p>The <b>write_leds</b> is specified as callback function. It gets called when the <b>LedOut</b> is written: </p>
<div class="fragment"><div class="line">write_leds },</div>
</div><!-- fragment --><p>Finally we need the actual variable definition: </p>
<div class="fragment"><div class="line"><span class="keyword">static</span> uint8_t LedOut;</div>
</div><!-- fragment --><p>For the <b>LedOut</b> control we actually need the following parts of code to be defined in <b>SNMP_MIB.c</b> module: </p>
<div class="fragment"><div class="line"><span class="keyword">static</span> uint8_t LedOut;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> write_leds (<span class="keywordtype">int</span> mode);</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> snmp_mib snmp_mib[] = {</div>
<div class="line">    ..</div>
<div class="line">  <span class="comment">// LedOut Entry</span></div>
<div class="line">  { <a class="code" href="rl__net_8h.html#a92acf1076e5ce592999db4170e38b2c5">MIB_INTEGER</a>,</div>
<div class="line">    6, {<a class="code" href="rl__net_8h.html#a524c32f35c707a1bf6b256c3d86b5ee0">MIB_OID0</a>(1,3), 6, 1, 3, 1, 0},</div>
<div class="line">    <a class="code" href="rl__net_8h.html#afa16c5468f05022f71c6abe68d506466">MIB_INT</a>(LedOut),</div>
<div class="line">    write_leds },</div>
<div class="line">    ..</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> write_leds (<span class="keywordtype">int</span> mode) {</div>
<div class="line">  <span class="comment">// No action on read access.</span></div>
<div class="line">  <span class="keywordflow">if</span> (mode == <a class="code" href="rl__net_8h.html#afbb3e128c46941c1e99d65bb26a571cc">MIB_WRITE</a>) {</div>
<div class="line">    LED_out (LedOut);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Extended OID Encoding </h2>
<p>The value of OID address byte must be less than <b>128</b>. If it is not, an OID address must be encoded in extended format. This is because the high bit of an address byte is an address <b>extension bit</b>.</p>
<p>For example, the OID address 1.3.6.1.4.1.<b>311</b>.0 is encoded as: </p>
<div class="fragment"><div class="line">8, {<a class="code" href="rl__net_8h.html#a524c32f35c707a1bf6b256c3d86b5ee0">MIB_OID0</a>(1,3), 6, 1, 4, 1, 130, 55, 0},</div>
</div><!-- fragment --><p>The address value for the highlighted numbers is calculated as: </p>
<div class="fragment"><div class="line">(130-128) * 128 + 55 = 311</div>
</div><!-- fragment --><p>The OID address 1.3.6.1.4.1.<b>31036</b>.50.1.1.0 is encoded as: </p>
<div class="fragment"><div class="line">12, {<a class="code" href="rl__net_8h.html#a524c32f35c707a1bf6b256c3d86b5ee0">MIB_OID0</a>(1,3), 6, 1, 4, 1, 129, 242, 60, 50, 1, 1, 0},</div>
</div><!-- fragment --><p>where the value 31036 is calculated as: </p>
<div class="fragment"><div class="line">(129-128) * 128 * 128 + (242-128) * 128 + 60 = 31036</div>
</div><!-- fragment --><h1><a class="anchor" id="using_snmp_agent_conf"></a>
SNMP Agent Configuration</h1>
<div class="image">
<img src="net_config_snmp_agent_h.png" alt="net_config_snmp_agent_h.png"/>
<div class="caption">
SNMP Agent Configuration File</div></div>
<p> The SNMP agent configuration file <b>Net_Config_SNMP_Agent.h</b> contains the following settings:</p>
<ul>
<li><b>Community Name</b> specifies the SNMP Community where an SNMP message is destined for. Only the members of the same community can communicate with each other using SNMP protocol. Default Community name is <b>public</b>.</li>
<li><b>Port Number</b> specifies the listening UDP port number. The default SNMP Agent listening port is 161.</li>
<li><b>Trap Port Number</b> specifies the UDP port number for Trap operations. The default SNMP Agent trap port is 162.</li>
<li><b>Trap Server</b> specifies the IP address of the Trap Server which receives Trap messages. This IP address is used when the Trap Server IP is not specified in <a class="el" href="group__snmp__routines.html#gafb6789902c478645eca2253c1c7a6341" title="Send a trap message to the Trap Manager. ">snmp_trap()</a> function parameter. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="using_network_components.html">Using Network Components</a></li><li class="navelem"><a class="el" href="using_network_services.html">Services</a></li>
    <li class="footer">Generated on Tue May 25 2021 13:57:55 for Network Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
