<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>HTTP Web Server</title>
<title>Network Component: HTTP Web Server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Network Component
   &#160;<span id="projectnumber">Version 6.7.7</span>
   </div>
   <div id="projectbrief">MDK-Professional Middleware for IP Networking</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('using_http_server.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">HTTP Web Server </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Hypertext Mark-up Language (HTML) is the primary language for formatting web pages. With HTML, you describe what a page must look like, what types of fonts to use, what colour the text should be, where paragraph marks must come, and many more aspects of the document.</p>
<p>There are two types of web pages which are stored on a web server and sent to a web client on request:</p>
<ul>
<li><b>Static Web pages</b> do not change their content. When the page is requested, it is sent to the web client as it is. It is not modified.</li>
<li><b>Dynamic Web pages</b> are generated when the page is requested. Pages that show system settings or log records are examples of dynamic pages.</li>
</ul>
<p>The Network Component supports both of them. Static web pages are generally stored in the ROM file system. The files are converted into C-code by the <a href="http://www.keil.com/support/man/docs/uv4/uv4_ut_fcarmuv.htm" class="el" target="_blank">FCARM</a> file converter and compiled into code.</p>
<p>There are basically two types of web servers available in the Network Component. The <b>Compact Web Server</b> can store HTML files only in its ROM. An update of these pages is not possible. The <b>Full Web Server</b> uses the File System Component to store data on a storage device. These files can be updated in the field. Both web servers have integrated several advanced features, which support the usage of many advanced web technologies:</p>
<ul>
<li>A <a class="el" href="using_http_server.html#ws_script_langugage">Script Language</a> is used to generate Dynamic Web pages.</li>
<li><a class="el" href="using_http_server.html#ws_ajax">AJAX Programming</a> allows you to move the web page processing from the web server to the client browser.</li>
<li><a class="el" href="using_http_server.html#ws_soap">SOAP Support</a> allows you to produce some cutting edge user interfaces.</li>
<li><a class="el" href="using_http_server.html#ws_web_pages">Web Pages</a> store the actual content that will be delivered by the web server.</li>
<li><a class="el" href="using_http_server.html#ws_http_caching">HTTP Caching</a> supports the local caching at the browser and improves the Web Server performance a lot.</li>
<li><a class="el" href="using_http_server.html#ws_web_on_sd">Web on SD Card</a> allows you to store the complete web site resource files on SD Card. Web files can be updated with HTTP file upload.</li>
<li><a class="el" href="using_http_server.html#ws_access_filtering">Access Filtering</a> allows you to filter out the hosts, which are not allowed to connect to the Web Server.</li>
<li><a class="el" href="using_http_server.html#ws_multilingo">Multi-language Web Pages</a> help you to generate language specific web pages with the help of the integrated script language.</li>
<li><a class="el" href="using_http_server.html#ws_multiuser">Multi-user Web Authentication</a> allows you to manage user accounts and access rights for each user.</li>
</ul>
<h1><a class="anchor" id="ws_script_langugage"></a>
Script Language</h1>
<p>The Network Component provides a small script language which can be used to generate truly dynamic web pages. The HTTP Server processes the script source file line by line and calls the <a class="el" href="group__net__http_func.html">CGI functions</a> as needed. The output from a CGI function is sent to the web client as a part of the web page.</p>
<p>Each script line starts with a <b>command character</b> which specifies a command for the script interpreter. The script language itself is simple and works as follows: </p>
<table class="doxtable">
<tr>
<th>Command</th><th>Description  </th></tr>
<tr>
<td>i </td><td>Commands the script interpreter to <b>include a file</b> from the file system and to output the content on the web browser. </td></tr>
<tr>
<td>t </td><td>Commands that the <b>line of text</b> that follows is to be output to the browser. </td></tr>
<tr>
<td>c </td><td>Calls a C function from the HTTP_Server_CGI.c file. The function may be followed by the line of text which is passed to <b><a class="el" href="group__net__http_func.html#ga977b2d34678313ddbc047fd4f5b2e55b" title="Generate dynamic web data from a script line. ">cgi_script()</a></b> as a pointer to an environment variable. </td></tr>
<tr>
<td># </td><td>This is a comment line and is ignored by the interpreter. </td></tr>
<tr>
<td>. </td><td>Denotes the last script line. </td></tr>
</table>
<p>Here is an example of a web page written in the script language. This web page edits or changes the system password. The web page is stored in three files (two are static, and the third (main file) is the script file that generates dynamic data). The script <b>system.cgi</b> contains the following: </p>
<div class="fragment"><div class="line">i password_h.inc</div>
<div class="line">c d 1 &lt;TR&gt;&lt;TD&gt;&lt;IMG SRC=pabb.gif&gt;Authentication&lt;/TD&gt;&lt;TD&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/TD&gt;&lt;/TR&gt;</div>
<div class="line">t &lt;TR&gt;&lt;TD&gt;&lt;IMG SRC=pabb.gif&gt;Password <span class="keywordflow">for</span> user <span class="stringliteral">&#39;admin&#39;</span>&lt;/TD&gt;</div>
<div class="line">c d 2 &lt;TD&gt;&lt;INPUT TYPE=TEXT NAME=pw SIZE=10 MAXLENGTH=10 VALUE=<span class="stringliteral">&quot;%s&quot;</span>&gt;&lt;/TD&gt;&lt;/TR&gt;</div>
<div class="line">t &lt;TR&gt;&lt;TD&gt;&lt;IMG SRC=pabb.gif&gt;Retype your password&lt;/TD&gt;</div>
<div class="line">c d 2 &lt;TD&gt;&lt;INPUT TYPE=TEXT NAME=pw2 SIZE=10 MAXLENGTH=10 VALUE=<span class="stringliteral">&quot;%s&quot;</span>&gt;&lt;/TD&gt;&lt;/TR&gt;</div>
<div class="line">i password_f.inc</div>
<div class="line">.</div>
</div><!-- fragment --><p>The web page header, which is <b>static</b> and does not change when the web page is generated, is moved into the separate header file <b>password_h.inc</b>. The content of the included page header file is: </p>
<div class="fragment"><div class="line">&lt;HTML&gt;</div>
<div class="line">  &lt;HEAD&gt;</div>
<div class="line">    &lt;TITLE&gt;System Settings&lt;/TITLE&gt;</div>
<div class="line">  &lt;/HEAD&gt;</div>
<div class="line">  &lt;BODY TEXT=#000000 BGCOLOR=#ccddff LINK=#0000FF VLINK=#0000FF ALINK=#FF0000&gt;</div>
<div class="line">  &lt;H2 ALIGN=CENTER&gt;System Settings&lt;/H2&gt;</div>
<div class="line">  &lt;FORM ACTION=index.htm METHOD=POST NAME=CGI&gt;</div>
<div class="line">  &lt;TABLE BORDER=0 WIDTH=99%&gt;</div>
<div class="line">  &lt;TR BGCOLOR=#aaccff&gt;</div>
<div class="line">    &lt;TH WIDTH=40%&gt;Item&lt;/TH&gt;</div>
<div class="line">    &lt;TH WIDTH=60%&gt;Setting&lt;/TH&gt;</div>
<div class="line">  &lt;/TR&gt;</div>
</div><!-- fragment --><p> It is <b>included</b> into the generated web page with the following script command: </p>
<div class="fragment"><div class="line">i password_h.inc</div>
</div><!-- fragment --><p> The web page footer is also <b>static</b> and is moved into the <b>password_f.inc</b> file. It is not changed when the web page generates but is simply included in the script. </p>
<div class="fragment"><div class="line">  &lt;TR&gt;</div>
<div class="line">    &lt;TD&gt;&amp;nbsp;&lt;/TD&gt;</div>
<div class="line">    &lt;TD&gt;&amp;nbsp;&lt;/TD&gt;</div>
<div class="line">  &lt;/TR&gt;</div>
<div class="line">  &lt;TR&gt;</div>
<div class="line">    &lt;TD&gt;&lt;/TD&gt;</div>
<div class="line">    &lt;TD align=<span class="stringliteral">&quot;right&quot;</span>&gt;</div>
<div class="line">      &lt;INPUT TYPE=SUBMIT NAME=set VALUE=<span class="stringliteral">&quot;Change&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;sbm&quot;</span>&gt;</div>
<div class="line">      &lt;INPUT TYPE=RESET VALUE=<span class="stringliteral">&quot;Undo&quot;</span>&gt;</div>
<div class="line">      &lt;INPUT TYPE=BUTTON VALUE=<span class="stringliteral">&quot;Home&quot;</span> OnClick=<span class="stringliteral">&quot;location=&#39;/index.htm&#39;&quot;</span>&gt;</div>
<div class="line">    &lt;/TD&gt;</div>
<div class="line">  &lt;/TR&gt;</div>
<div class="line">  &lt;/FORM&gt;</div>
<div class="line">  &lt;p&gt;This page allows you to change the system &lt;b&gt;Password&lt;/b&gt;, <span class="keywordflow">for</span> the username</div>
<div class="line">    &lt;b&gt;admin&lt;/b&gt;. Default &lt;b&gt;realm&lt;/b&gt;, &lt;b&gt;user&lt;/b&gt; and &lt;b&gt;password&lt;/b&gt; can be set</div>
<div class="line">    in configuration file. This Form uses a &lt;b&gt;POST&lt;/b&gt; method to <a class="code" href="group__bsd__routines.html#ga27f7859e634a2cd0ab98219b5092f7f7">send</a> data back to</div>
<div class="line">    a Web server. You need to click on &lt;b&gt;Change&lt;/b&gt; button to activate the changes.</div>
<div class="line">  &lt;/p&gt;</div>
<div class="line">  &lt;/BODY&gt;</div>
<div class="line">&lt;/HTML&gt;</div>
</div><!-- fragment --><p> This is how the generated web page looks like, with the dynamically generated items in the <b>Setting</b> column:</p>
<div class="image">
<img src="generated_page.png" alt="generated_page.png"/>
</div>
<p>You can see the HTML source code of this web page. This data is actually sent to the web client when the client requests the web page <b>system.cgi</b>. The script file is processed by the script interpreter, and the following data is generated by the Web Server. You can compare the generated HTML source with the script file to see where the CGI interface comes in. </p>
<div class="fragment"><div class="line">&lt;HTML&gt;</div>
<div class="line">  &lt;HEAD&gt;</div>
<div class="line">    &lt;TITLE&gt;System Settings&lt;/TITLE&gt;</div>
<div class="line">  &lt;/HEAD&gt;</div>
<div class="line">  &lt;BODY TEXT=#000000 BGCOLOR=#ccddff LINK=#0000FF VLINK=#0000FF ALINK=#FF0000&gt;</div>
<div class="line">  &lt;H2 ALIGN=CENTER&gt;System Settings&lt;/H2&gt;</div>
<div class="line">  &lt;FORM ACTION=index.htm METHOD=POST NAME=CGI&gt;</div>
<div class="line">  &lt;TABLE BORDER=0 WIDTH=99%&gt;</div>
<div class="line">  &lt;TR BGCOLOR=#aaccff&gt;</div>
<div class="line">    &lt;TH WIDTH=40%&gt;Item&lt;/TH&gt;</div>
<div class="line">    &lt;TH WIDTH=60%&gt;Setting&lt;/TH&gt;</div>
<div class="line">  &lt;/TR&gt;</div>
<div class="line">  &lt;TR&gt;&lt;TD&gt;&lt;IMG SRC=pabb.gif&gt;Authentication&lt;/TD&gt;&lt;TD&gt;&lt;b&gt;Enabled&lt;/b&gt;&lt;/TD&gt;&lt;/TR&gt;</div>
<div class="line">  &lt;TR&gt;&lt;TD&gt;&lt;IMG SRC=pabb.gif&gt;Password <span class="keywordflow">for</span> user <span class="stringliteral">&#39;admin&#39;</span>&lt;/TD&gt;</div>
<div class="line">  &lt;TD&gt;&lt;INPUT TYPE=TEXT NAME=pw SIZE=10 MAXLENGTH=10 VALUE=<span class="stringliteral">&quot;test&quot;</span>&gt;&lt;/TD&gt;&lt;/TR&gt;</div>
<div class="line">  &lt;TR&gt;&lt;TD&gt;&lt;IMG SRC=pabb.gif&gt;Retype your password&lt;/TD&gt;</div>
<div class="line">  &lt;TD&gt;&lt;INPUT TYPE=TEXT NAME=pw2 SIZE=10 MAXLENGTH=10 VALUE=<span class="stringliteral">&quot;test&quot;</span>&gt;&lt;/TD&gt;&lt;/TR&gt;</div>
<div class="line">  &lt;TR&gt;</div>
<div class="line">    &lt;TD&gt;&amp;nbsp;&lt;/TD&gt;</div>
<div class="line">    &lt;TD&gt;&amp;nbsp;&lt;/TD&gt;</div>
<div class="line">  &lt;/TR&gt;</div>
<div class="line">  &lt;TR&gt;</div>
<div class="line">    &lt;TD&gt;&lt;/TD&gt;</div>
<div class="line">    &lt;TD align=<span class="stringliteral">&quot;right&quot;</span>&gt;</div>
<div class="line">      &lt;INPUT TYPE=SUBMIT NAME=set VALUE=<span class="stringliteral">&quot;Change&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;sbm&quot;</span>&gt;</div>
<div class="line">      &lt;INPUT TYPE=RESET VALUE=<span class="stringliteral">&quot;Undo&quot;</span>&gt;</div>
<div class="line">      &lt;INPUT TYPE=BUTTON VALUE=<span class="stringliteral">&quot;Home&quot;</span> OnClick=<span class="stringliteral">&quot;location=&#39;/index.htm&#39;&quot;</span>&gt;</div>
<div class="line">    &lt;/TD&gt;</div>
<div class="line">  &lt;/TR&gt;</div>
<div class="line">  &lt;/FORM&gt;</div>
<div class="line">  &lt;p&gt;This page allows you to change the system &lt;b&gt;Password&lt;/b&gt;, <span class="keywordflow">for</span> the username</div>
<div class="line">    &lt;b&gt;admin&lt;/b&gt;. Default &lt;b&gt;realm&lt;/b&gt;, &lt;b&gt;user&lt;/b&gt; and &lt;b&gt;password&lt;/b&gt; can be set</div>
<div class="line">    in configuration file. This Form uses a &lt;b&gt;POST&lt;/b&gt; method to <a class="code" href="group__bsd__routines.html#ga27f7859e634a2cd0ab98219b5092f7f7">send</a> data back to</div>
<div class="line">    a Web server. You need to click on &lt;b&gt;Change&lt;/b&gt; button to activate the changes.</div>
<div class="line">  &lt;/p&gt;</div>
<div class="line">  &lt;/BODY&gt;</div>
<div class="line">&lt;/HTML&gt;</div>
</div><!-- fragment --><p><b>Code Example for HTTP_Server_CGI.c</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__net_8h.html">rl_net.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Process query string received by GET request.</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__net__http_func.html#ga344e2edc2397fa27fd78354c27312bcc">cgi_process_query</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *qstr) {</div>
<div class="line">  <span class="keywordtype">char</span> var[40];</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">do</span> {</div>
<div class="line">    <span class="comment">// Loop through all the parameters</span></div>
<div class="line">    qstr = <a class="code" href="group__net__http_func.html#ga6f2f9fb059e4d34ee12a93582bfd7ed3">http_get_env_var</a> (qstr, var, <span class="keyword">sizeof</span> (var));</div>
<div class="line">    <span class="comment">// Check return string, &#39;qstr&#39; now points to the next parameter</span></div>
<div class="line">    <span class="keywordflow">if</span> (var[0] != 0) {</div>
<div class="line">      <span class="comment">// First character is non-null, string exists</span></div>
<div class="line"></div>
<div class="line">      <span class="comment">/* Example of a parameter &quot;ip=192.168.0.100&quot;</span></div>
<div class="line"><span class="comment">      if (strncmp (var, &quot;ip=&quot;, 3) == 0) {</span></div>
<div class="line"><span class="comment">        uint8_t ip_addr[IP4_ADDR_LEN];</span></div>
<div class="line"><span class="comment">        // Read parameter IP address submitted by the browser</span></div>
<div class="line"><span class="comment">        ip4_aton (&amp;var[3], ip_addr);</span></div>
<div class="line"><span class="comment">         ...</span></div>
<div class="line"><span class="comment">      }</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">while</span> (qstr);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Process data received by POST request.</span></div>
<div class="line"><span class="comment">// Type code: - 0 = www-url-encoded form data.</span></div>
<div class="line"><span class="comment">//            - 1 = filename for file upload (null-terminated string).</span></div>
<div class="line"><span class="comment">//            - 2 = file upload raw data.</span></div>
<div class="line"><span class="comment">//            - 3 = end of file upload (file close requested).</span></div>
<div class="line"><span class="comment">//            - 4 = any other type of POST data (single or last stream).</span></div>
<div class="line"><span class="comment">//            - 5 = the same as 4, but with more data to follow.</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__net__http_func.html#gad489f3562d1482e32ffa11f8045333cb">cgi_process_data</a> (uint8_t code, <span class="keyword">const</span> <span class="keywordtype">char</span> *data, uint32_t len) {</div>
<div class="line">  <span class="keywordtype">char</span> var[40];</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (code) {</div>
<div class="line">    <span class="keywordflow">case</span> 0:</div>
<div class="line">      <span class="comment">// Url encoded form data received</span></div>
<div class="line">      <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="comment">// Parse all parameters</span></div>
<div class="line">        data = <a class="code" href="group__net__http_func.html#ga6f2f9fb059e4d34ee12a93582bfd7ed3">http_get_env_var</a> (data, var, <span class="keyword">sizeof</span> (var));</div>
<div class="line">        <span class="keywordflow">if</span> (var[0] != 0) {</div>
<div class="line">          <span class="comment">// First character is non-null, string exists</span></div>
<div class="line">          <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">          if (strcmp (var, &quot;led0=on&quot;) == 0) {</span></div>
<div class="line"><span class="comment">            // ... Switch LED 0 on</span></div>
<div class="line"><span class="comment">          }</span></div>
<div class="line"><span class="comment">          */</span></div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">while</span> (data);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 1:</div>
<div class="line">      <span class="comment">// Filename for file upload received</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      if (data[0] != 0) {</span></div>
<div class="line"><span class="comment">        // Open a file for writing</span></div>
<div class="line"><span class="comment">        file = fopen (var, &quot;w&quot;);</span></div>
<div class="line"><span class="comment">      }</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 2:</div>
<div class="line">      <span class="comment">// File content data received</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      if (file != NULL) {</span></div>
<div class="line"><span class="comment">        // Write data to a file</span></div>
<div class="line"><span class="comment">        fwrite (data, 1, len, file);</span></div>
<div class="line"><span class="comment">      }</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 3:</div>
<div class="line">      <span class="comment">// File upload finished</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      if (file != NULL) {</span></div>
<div class="line"><span class="comment">        // Close a file</span></div>
<div class="line"><span class="comment">        fclose (file);</span></div>
<div class="line"><span class="comment">      }</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 4:</div>
<div class="line">      <span class="comment">// Other content type data, last packet</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      if (strcmp (http_get_content_type(), &quot;text/xml; charset=utf-8&quot; == 0) {</span></div>
<div class="line"><span class="comment">        // Content type xml, utf-8 encoding</span></div>
<div class="line"><span class="comment">         ...</span></div>
<div class="line"><span class="comment">      }</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 5:</div>
<div class="line">      <span class="comment">// Other content type data, more to follow</span></div>
<div class="line">      <span class="comment">// ... Process data</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <span class="comment">// Ignore all other codes</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Generate dynamic web data from a script line.</span></div>
<div class="line">uint32_t <a class="code" href="group__net__http_func.html#ga977b2d34678313ddbc047fd4f5b2e55b">cgi_script</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *env, <span class="keywordtype">char</span> *buf, uint32_t buflen, uint32_t *pcgi) {</div>
<div class="line">  uint32_t len = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Analyze a &#39;c&#39; script line starting position 2</span></div>
<div class="line">  <span class="comment">/* Example script</span></div>
<div class="line"><span class="comment">  // c a i &lt;td&gt;&lt;input type=text name=ip value=&quot;%s&quot; size=18 maxlength=18&gt;&lt;/td&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  switch (env[0]) {</span></div>
<div class="line"><span class="comment">    case &#39;a&#39; :</span></div>
<div class="line"><span class="comment">      switch (env[2]) {</span></div>
<div class="line"><span class="comment">        case &#39;i&#39;:</span></div>
<div class="line"><span class="comment">          // Write the local IP address</span></div>
<div class="line"><span class="comment">          len = sprintf (buf, &amp;env[4], ip4_ntoa (IpAddr));</span></div>
<div class="line"><span class="comment">          break;</span></div>
<div class="line"><span class="comment">          ...</span></div>
<div class="line"><span class="comment">      }</span></div>
<div class="line"><span class="comment">      break;</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (len);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Override default Content-Type for CGX script files.</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="group__net__http_func.html#ga092702be389b4b1aa5dff5d00b2a4841">cgx_content_type</a> (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">  return (&quot;text/xml; charset=utf-8&quot;);</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (NULL);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Override default character encoding in html documents.</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="group__net__http_func.html#ga3640efd81eebd825d238d153407d52a2">http_encoding</a> (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">  return (&quot;utf-8&quot;);</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (NULL);</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd><ul>
<li>The script files use the reserved filename extension of <b>cgi</b>. Using the cgi filename extension for script files is mandatory for the Web Server script interpreter to recognize and process the script files.</li>
<li>The script line length is <b>limited</b> to 120 characters.</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="ws_ajax"></a>
AJAX Programming</h1>
<p>AJAX is a group of web development techniques used on the client-side to create interactive web applications. AJAX is a shorthand for <b>Asynchronous JavaScript and XML</b>. With AJAX web applications can retrieve data from the server asynchronously in the background without interfering with the display and behaviour of the existing page.</p>
<p>AJAX is based on <b>JavaScript</b> and <b>HTTP requests</b>. It is not a new programming language, but a new way to use existing standards. JavaScript is the most popular language for AJAX programming due to its inclusion in and compatibility with the majority of modern web browsers.</p>
<h2>How it works </h2>
<p>In Ajax programming, the browser sends a standard HTTP request to the web server, such as GET or POST. The web server checks the file extension of the requested file. If the file extension is <b>cgx</b>, the requested file is an XML script file. This file is processed by internal script interpreter running on the web server. As a result the XML response is generated and sent back to the browser.</p>
<p>Here is a an example of a typical data flow:</p>
<ul>
<li>Web browser sends a standard HTTP GET request: <div class="fragment"><div class="line">GET /ad.cgx HTTP/1.1\r\n</div>
</div><!-- fragment --></li>
<li>Web server processes the script file ad.cgx and sends the XML response: <div class="fragment"><div class="line">&lt;form&gt;&lt;text&gt;&lt;<span class="keywordtype">id</span>&gt;ad_value&lt;/<span class="keywordtype">id</span>&gt;&lt;value&gt;0x06A&lt;/value&gt;&lt;/text&gt;&lt;/form&gt;</div>
</div><!-- fragment --></li>
<li>The <b>JavaScript</b> XML parser in the web browser processes this response and updates the object with id <b>ad_value</b> on the web page. <div class="fragment"><div class="line">&lt;input type=<span class="stringliteral">&quot;text&quot;</span> readonly size=<span class="stringliteral">&quot;10&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;ad_value&quot;</span> value=<span class="stringliteral">&quot;0x06A&quot;</span>&gt;</div>
</div><!-- fragment --></li>
</ul>
<h2>XML </h2>
<p>XML, a shorthand for Extensible Markup Language, is a simple, very flexible text format. It is a generic framework for storing any amount of any data whose structure can be represented as a <b>tree</b>. It allows the user to create the mark-up elements. XML has become the almost universally supported way of exchanging documents and data across applications and platforms. The benefits of using XML technology for web page update are obvious:</p>
<ul>
<li>Instead of several files, only <b>one small</b> XML file is transferred for web page update.</li>
<li>This allows <b>faster</b>, <b>flicker-free</b> screen updates.</li>
<li>The used LAN bandwidth is very small.</li>
<li>The web server can easily handle <b>more clients</b> at the same time.</li>
</ul>
<p>The components of XML file are <b>tagged</b>. You must use this format for generated XML responses. The object ID's and their values must be specified within XML body - enclosed with tags <b>&lt;form&gt;</b> and <b>&lt;/form&gt;</b>. The following objects are defined:</p>
<ul>
<li><b>Text</b> object: <div class="fragment"><div class="line">&lt;text&gt;</div>
<div class="line">  &lt;<span class="keywordtype">id</span>&gt;text_id&lt;/<span class="keywordtype">id</span>&gt;</div>
<div class="line">  &lt;value&gt;text_value&lt;/value&gt;</div>
<div class="line">&lt;/text&gt;</div>
</div><!-- fragment --></li>
<li><b>Checkbox</b> object: <div class="fragment"><div class="line">&lt;checkbox&gt;</div>
<div class="line">  &lt;<span class="keywordtype">id</span>&gt;checkbox_id&lt;/<span class="keywordtype">id</span>&gt;</div>
<div class="line">  &lt;checked&gt;<span class="keyword">true</span>/<span class="keyword">false</span>&lt;/checked&gt;</div>
<div class="line">&lt;/checkbox&gt;</div>
</div><!-- fragment --></li>
<li><b>Select</b> object: <div class="fragment"><div class="line">&lt;select&gt;</div>
<div class="line">  &lt;<span class="keywordtype">id</span>&gt;option_id&lt;/<span class="keywordtype">id</span>&gt;</div>
<div class="line">  &lt;value&gt;<span class="keyword">true</span>/<span class="keyword">false</span>&lt;/value&gt;</div>
<div class="line">&lt;/select&gt;</div>
</div><!-- fragment --></li>
<li><b>Radio</b> object: <div class="fragment"><div class="line">&lt;radio&gt;</div>
<div class="line">  &lt;<span class="keywordtype">id</span>&gt;radio_id&lt;/<span class="keywordtype">id</span>&gt;</div>
<div class="line">  &lt;value&gt;<span class="keyword">true</span>/<span class="keyword">false</span>&lt;/value&gt;</div>
<div class="line">&lt;/radio&gt;</div>
</div><!-- fragment --> The other HTTP objects are optional. You can add them yourself.</li>
</ul>
<h2>XML Example </h2>
<p>Here is an example of a XML web page update written in the script language. This web page displays the value of an analog input (AD). When first opened, a complete AD web page is generated by the web server. Later, when you enable the periodic update of the page, this page is updated with a Java Script function <b>updateMultiple()</b>. This function is in the <b>xml_http.js</b> file.</p>
<ul>
<li>The script file <b>ad.cgx</b> contains the following: <div class="fragment"><div class="line">t &lt;form&gt;</div>
<div class="line">t &lt;text&gt;</div>
<div class="line">t &lt;id&gt;ad_value&lt;/<span class="keywordtype">id</span>&gt;</div>
<div class="line">c x&lt;value&gt;0x%03X&lt;/value&gt;</div>
<div class="line">t &lt;/text&gt;</div>
<div class="line">t &lt;/form&gt;</div>
<div class="line">.</div>
</div><!-- fragment --></li>
<li>The script interpreter processes this file and generates the following response: <div class="fragment"><div class="line">&lt;form&gt;&lt;text&gt;&lt;<span class="keywordtype">id</span>&gt;ad_value&lt;/<span class="keywordtype">id</span>&gt;&lt;value&gt;0x06A&lt;/value&gt;&lt;/text&gt;&lt;/form&gt;</div>
</div><!-- fragment --> The XML response does not contain any spaces or CR-LF characters between the XML tags.</li>
<li>The Java Script function <b>periodicUpdateAd()</b> activates the periodic time-outs for the page update. This function is specific for the AD page module and is included in the <b>ad.cgi</b> script file: <div class="fragment"><div class="line"><span class="keyword">function</span> periodicUpdateAd() {</div>
<div class="line">  <span class="keywordflow">if</span>(document.getElementById(<span class="stringliteral">&quot;adChkBox&quot;</span>).checked == <span class="keyword">true</span>) {</div>
<div class="line">    updateMultiple(formUpdate,plotADGraph);</div>
<div class="line">    ad_elTime = setTimeout(periodicUpdateAd, formUpdate.period);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    clearTimeout(ad_elTime);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>The update <b>interval</b> and <b>URL</b> are defined in the <b>formUpdate</b> object. When update interval expires, a XML response is requested from the URL specified in this Java object. <div class="fragment"><div class="line">var formUpdate = <span class="keyword">new</span> periodicObj(<span class="stringliteral">&quot;ad.cgx&quot;</span>, 500);</div>
</div><!-- fragment --></li>
<li>The actual update of the analog bar and AD values on the web page is done by the Java function <b>plotADGraph()</b>: <div class="fragment"><div class="line"><span class="keyword">function</span> plotADGraph() {</div>
<div class="line">  adVal = document.getElementById(<span class="stringliteral">&quot;ad_value&quot;</span>).value;</div>
<div class="line">  numVal = parseInt(adVal, 16);</div>
<div class="line">  voltsVal = (3.3*numVal)/1024;</div>
<div class="line">  tableSize = (numVal*100/1024);</div>
<div class="line">  document.getElementById(<span class="stringliteral">&quot;ad_table&quot;</span>).style.width = (tableSize + <span class="charliteral">&#39;%&#39;</span>);</div>
<div class="line">  document.getElementById(<span class="stringliteral">&quot;ad_volts&quot;</span>).value = (voltsVal.toFixed(3) + <span class="stringliteral">&#39; V&#39;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> This function is called as a callback function from the <b>updateMultiple()</b> Java function.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The XML script files use the reserved filename extension <b>cgx</b>. Using the <b>cgx</b> file extension for XML script files is <b>mandatory</b> for the web Server script interpreter to recognize and process the XML script files.</li>
<li>There must be <b>no spaces</b> or CR-LF characters between XML tags, or some web browsers might have problems when parsing the XML response.</li>
<li>The script line length is <b>limited to 120 characters</b>.</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="ws_soap"></a>
SOAP Support</h1>
<p>The <b>Simple Object Access Protocol (SOAP)</b>, is a XML-based protocol to let applications exchange information over HTTP. It is created to enable communication between applications. It is important for application development to allow Internet communication between programs. A better way to communicate between applications is over HTTP, because HTTP is supported by all Internet browsers and servers. SOAP provides a way to communicate between applications running on different operating systems, with different technologies and programming languages.</p>
<h2>SOAP Interface </h2>
<p>SOAP messages in HTTP consist of a <b>POST</b> request, submitted by the client, and a response generated by the web server. The Embedded Web server handles SOAP messages differently. Instead of processing them internally and notifying the user via a callback function, it delivers a complete SOAP message to the user via the callback function.</p>
<p>In general, SOAP messages are large. Embedded systems that run a web server with SOAP, need much more RAM for message buffering and processing. A typical configuration would have:</p>
<ul>
<li>a few MBytes of RAM.</li>
<li>a SD Card for deploying a web service application.</li>
</ul>
<p>The following extensions have been added to the web server:</p>
<ul>
<li>the <a class="el" href="group__net__http_func.html#gad489f3562d1482e32ffa11f8045333cb">cgi_process_data</a> function has been extended with code 4 and 5 to allow processing of fragmented large POST messages.</li>
<li>the <code>Content-Type</code> HTTP header for XML-encoded POST requests is <b>buffered</b>. The function <a class="el" href="group__net__http_func.html#ga940b475ffc39fc39ec692b536106dc47">http_server_get_content_type</a> returns a pointer to the Content-Type string, which was received in the XML POST request.</li>
<li>the <code>Content-Type</code> header for the response can be defined by the user in the <a class="el" href="group__net__http_func.html#ga092702be389b4b1aa5dff5d00b2a4841">cgx_content_type</a> function.</li>
<li>the <a class="el" href="group__net__http_func.html#gafe5c5a991a4d01baf11ef291a5c6ef6a">http_server_get_session</a> function is used to identify which web server session has called a <a class="el" href="group__net__http_func.html#gad489f3562d1482e32ffa11f8045333cb">cgi_process_data</a> callback function, if two or more clients have sent POST requests at the same time.</li>
<li>the <a class="el" href="using_http_server.html#ws_http_caching">HTTP Caching</a> improves the web server performance a lot when serving large web service applications.</li>
</ul>
<h2>Large POST Messages </h2>
<p>When the web server receives a POST request, the server checks the <code>Content-Type</code> header. All XML-encoded content types are not processed further, but the data is delivered to the user in a callback function. It is the responsibility of the user to correctly <b>assemble</b> large POST messages, because they are fragmented and delivered from several TCP packets. For the first and optional subsequent packets, the web server calls the callback function with code 5: </p>
<div class="fragment"><div class="line"><a class="code" href="group__net__http_func.html#gad489f3562d1482e32ffa11f8045333cb">cgi_process_data</a> (5, dat, len);</div>
</div><!-- fragment --><p>The user should now start to buffer the data.</p>
<p>For the <b>last</b> or <b>single</b> data packet, the web server calls the callback function with code 4: </p>
<div class="fragment"><div class="line"><a class="code" href="group__net__http_func.html#gad489f3562d1482e32ffa11f8045333cb">cgi_process_data</a> (4, dat, len);</div>
</div><!-- fragment --><p>The POST data is now complete and the user can start parsing the XML encoded data. In addition the user might check what was the <code>Content-Type</code> with the function <a class="el" href="group__net__http_func.html#ga940b475ffc39fc39ec692b536106dc47">http_server_get_content_type</a>.</p>
<h1><a class="anchor" id="ws_web_pages"></a>
Web Pages</h1>
<p>The web pages for the web servers are created in the same way as the web pages for any other web server. You can use any text editor to edit the HTML code. It is a good idea to preview the page. Here are a few guidelines:</p>
<ul>
<li>Design a web page in HTML code. You can add <b>images</b> and <b>java script</b> functions as well.</li>
<li>If the web page needs to show dynamic values, code this page in the <a class="el" href="using_http_server.html#ws_script_langugage">Script Language</a>. You must also update the CGI callback function, <a class="el" href="group__net__http_func.html#ga977b2d34678313ddbc047fd4f5b2e55b">cgi_script</a>, accordingly. It is a good practice to program the script code and <a class="el" href="group__net__http_func.html#ga977b2d34678313ddbc047fd4f5b2e55b">cgi_script</a> in parallel. Note that the module <b>HTTP_Server_CGI.c</b> must be included in your project.</li>
<li>If needed, draw or add images, which can be of type gif, bmp, jpg, or png for example. A good choice is to select the image type with the best compression because these files are included in the code. Large image files might increase the application code size by a large extent.</li>
<li><p class="startli">To keep track of the web content, be advised to create a sub-folder in the µVision project called <b>Web</b> (for example). Add all files that the web server will deliver (HTML, images, etc.) as file type "Image File":</p>
<div class="image">
<img src="image_file.png" alt="image_file.png"/>
<div class="caption">
Add web content as Image File</div></div>
</li>
<li><p class="startli">Compile all web files using the <a class="el" href="nw_sw_utils.html">Software Utility: FCARM File Converter</a>. To setup FCARM, go to <b>Project</b> -&gt; <b>Options</b> <b>for</b> <b>Target</b> and select the <b>Utilities</b> tab. At the bottom, you can configure how FCARM compiles the image files. Here's an example:</p>
<div class="image">
<img src="fcarm_configuration.png" alt="fcarm_configuration.png"/>
<div class="caption">
Configure Image File Processing (FCARM) Dialog</div></div>
 <h2>Default Page </h2>
<p class="startli">When you type the URL or IP address in the browser's address bar, the web server sends the content of the <b>index.htm</b> web page. This is the default page, which is opened, as long as no filename is specified in the URL. If you enter the complete URL, including a filename (for example <a href="http://mcb1700/ad.htm">http://mcb1700/ad.htm</a>), then the web server tries to open this page.</p>
</li>
</ul>
<p>The default page <b>index.htm</b> is a static page. This means the content of this page is stored on the web server and sent unmodified to the web client on request. Usually this page contains links to other static or dynamic pages on the web server.</p>
<p>Sometimes, a dynamic page is preferred as a default web page. This is also supported. When a browser requests a default web page, the web server tries to open <b>index.htm</b> as default web page. If this page does not exist, web server in the next step tries to open <b>index.cgi</b> as a default page. If this page is also not existing, then the web server responds with <b>Error 404 - Not Found</b>.</p>
<dl class="section note"><dt>Note</dt><dd>If you want to use a dynamic default page, then the file index.htm <b>must not exist</b> on the web server.</dd></dl>
<h2>Error Pages </h2>
<p>Both web servers show an error page when encountering error conditions. </p>
<table class="doxtable">
<tr>
<th align="center">Error Code</th><th>Title </th><th>Description  </th></tr>
<tr>
<td align="center">401 </td><td>Unauthorized Access</td><td>You are not authorized to access this server </td></tr>
<tr>
<td align="center">403 </td><td>Forbidden </td><td>You don't have permission to access this resource </td></tr>
<tr>
<td align="center">404 </td><td>Not Found </td><td>The requested URL was not found on this server </td></tr>
<tr>
<td align="center">501 </td><td>Not Implemented </td><td>The requested method is not supported </td></tr>
</table>
<p>The error pages above are already included in the Network Component. If you want to modify them, you must copy the module <b>HTTP_Server_Error.c</b> to your project and customize it. To add the module to your project, simply right-click on the Source group, select <b>Add New Item to Group</b>, then click on <b>User Code Template</b> and scroll in the template files list until you find the <b>HTTP Server Error Messages</b> template. Modified error pages must be small because they are sent in a single TCP packet.</p>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__net__lib_8h.html">rl_net_lib.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Keep HTTP Error page size small</span></div>
<div class="line"><a class="code" href="group__net__internal__system__functions.html#struct_h_t_t_p___e_r_r_o_r">HTTP_ERROR</a> <a class="code" href="_h_t_t_p___server___error_8c.html#a1c9ae978514488ea10a4bda0d1696672">http_error</a> = {</div>
<div class="line">  <span class="comment">// HTTP Error page header</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;head&gt;&lt;title&gt;Server Error&lt;/title&gt;&lt;/head&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;body&gt;&quot;</span>,</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP Error page footer</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;hr&gt;&lt;br&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;i&gt;Keil Embedded WEB Server V2.00, 2013&lt;br&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;a href=http://www.keil.com&gt;www.keil.com&lt;/a&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot; - Embedded Development Tools&lt;/i&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;/body&gt;&quot;</span>,</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP Error 401 - Unauthorized access</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;h2&gt;Error 401 - Unauthorized Access&lt;/h2&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;You are not authorized to access this server.&quot;</span>,</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP Error 403 - Forbidden</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;h2&gt;Error 403 - Forbidden&lt;/h2&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;You don&#39;t have permission to access this resource.&quot;</span>,</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP Error 404 - Not Found</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;h2&gt;Error 404 - Not Found&lt;/h2&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;The requested URL was not found on this server.&quot;</span>,</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP Error 501 - Not Implemented</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;h2&gt;Error 501 - Not Implemented&lt;/h2&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;The requested Method is not supported.&quot;</span></div>
<div class="line">};</div>
</div><!-- fragment --> <h1><a class="anchor" id="ws_http_caching"></a>
HTTP Caching</h1>
<p>HTTP protocol supports <b>local caching</b> of static resources by the browser. Most web pages include resources that change infrequently, such as CSS files, image files, JavaScript files, and so on. These resources take time to download over the network, which increases the time it takes to load a web page. HTTP caching allows these resources to be saved, or cached, by a browser. Once a resource is cached, a browser can refer to the locally cached copy instead of having to download it again on subsequent visits to the web page.</p>
<p>The advantage of caching is obvious:</p>
<ul>
<li>The page <b>load time</b> for subsequent user visits is reduced, eliminating numerous HTTP requests for the required resources</li>
<li>The total <b>payload size</b> of the responses is reduced.</li>
</ul>
<h2>How it works </h2>
<p>The web server supports HTTP <b>local caching</b> by the browser. For static resources (basically everything except the scripts themselves), the server sends the HTTP header with the <b>last modified</b> date tag in the response.</p>
<h3>Resource not cached</h3>
<p>Here is an example. The browser opens a web page, which is not yet cached locally.</p>
<ul>
<li>The browser opens a default page: <div class="fragment"><div class="line">http:<span class="comment">//mcb1700</span></div>
</div><!-- fragment --></li>
<li>This generates the following HTTP request for the web server: <div class="fragment"><div class="line">GET / HTTP/1.1</div>
<div class="line">Accept: image/gif, image/jpeg, image/pjpeg, image/pjpeg, application/x-</div>
<div class="line">shockwave-flash, application/vnd.ms-excel, application/vnd.ms-powerpoint,</div>
<div class="line">application/msword, application/xaml+xml, application/vnd.ms-xpsdocument,</div>
<div class="line">application/x-ms-xbap, application/x-ms-application, *\<span class="comment">/*</span></div>
<div class="line"><span class="comment">Accept-Language: en-us</span></div>
<div class="line"><span class="comment">User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1;</span></div>
<div class="line"><span class="comment">Trident/4.0; .NET CLR 1.1.4322; InfoPath.1; .NET CLR 2.0.50727; .NET CLR</span></div>
<div class="line"><span class="comment">3.0.04506.30; .NET CLR 3.0.04506.648; .NET CLR 3.0.4506.2152; .NET CLR</span></div>
<div class="line"><span class="comment">3.5.30729)</span></div>
<div class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></div>
<div class="line"><span class="comment">Host: mcb1700</span></div>
<div class="line"><span class="comment">Connection: Keep-Alive</span></div>
</div><!-- fragment --></li>
<li>The web server opens a default page <em>index.htm</em> and sends it to the browser with the following HTTP header: <div class="fragment"><div class="line">HTTP/1.1 200 OK</div>
<div class="line">Server: Keil-EWEB/2.1</div>
<div class="line">Content-Type: text/html</div>
<div class="line">Last-Modified: Thu, 19 Nov 2009 07:46:25 GMT</div>
<div class="line">Connection: close</div>
<div class="line"><span class="comment">// and the content of &#39;index.htm&#39;</span></div>
</div><!-- fragment --></li>
<li>The browser, upon receiving the <b>Last-Modified</b> HTTP header, stores this file to a local cache together with the URL and the date tag.</li>
</ul>
<h3>Resource cached</h3>
<p>When the browser tries to open the same page again, it first checks the local cache. The file <em>index.htm</em> is already there, so it sends a different request to the Web server.</p>
<ul>
<li>The browser sends a different http header in the request: <div class="fragment"><div class="line">GET / HTTP/1.1</div>
<div class="line">Accept: *\<span class="comment">/*</span></div>
<div class="line"><span class="comment">Accept-Language: en-us</span></div>
<div class="line"><span class="comment">User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1;</span></div>
<div class="line"><span class="comment">Trident/4.0; .NET CLR 1.1.4322; InfoPath.1; .NET CLR 2.0.50727; .NET CLR</span></div>
<div class="line"><span class="comment">3.0.04506.30; .NET CLR 3.0.04506.648; .NET CLR 3.0.4506.2152; .NET CLR</span></div>
<div class="line"><span class="comment">3.5.30729)</span></div>
<div class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></div>
<div class="line"><span class="comment">If-Modified-Since: Thu, 19 Nov 2009 07:46:25 GMT</span></div>
<div class="line"><span class="comment">Host: mcb1700</span></div>
<div class="line"><span class="comment">Connection: Keep-Alive</span></div>
</div><!-- fragment --></li>
<li>Now, the web server is also informed that the requested file is cached. The web server checks the date, if the browser caches the same file version. If the date tags are equal, the Web server sends only a short response: <div class="fragment"><div class="line">HTTP/1.1 304 Not Modified</div>
<div class="line">Server: Keil-EWEB/2.1</div>
<div class="line">Connection: close</div>
</div><!-- fragment --></li>
<li>The browser now uses the locally cached <em>index.htm</em> </li>
</ul>
<h3>Outdated resource cached</h3>
<p>If the date tags are not equal, the file cached by browser is outdated. The web server sends the updated <em>index.htm</em>. The browser updates the local cache and uses an updated file. </p>
<div class="fragment"><div class="line">HTTP/1.1 200 OK</div>
<div class="line">Server: Keil-EWEB/2.1</div>
<div class="line">Content-Type: text/html</div>
<div class="line">Last-Modified: Thu, 19 Nov 2009 09:38:54 GMT</div>
<div class="line">Connection: close</div>
<div class="line"><span class="comment">// and the new content of &#39;index.htm&#39;</span></div>
</div><!-- fragment --><h2>Internal Web </h2>
<p>The internal web pages are included and compiled into the code. When the <a href="http://www.keil.com/support/man/docs/uv4/uv4_ut_fcarmuv.htm" class="el" target="_blank">FCARM</a> file converter reformats the web files into a single C-file, a timestamp is also added. </p>
<div class="fragment"><div class="line"><span class="keyword">const</span> uint32_t imageLastModified = 1380695329;</div>
</div><!-- fragment --><p> This time is used by the web server as the <b>File Modification Date</b>. It is specified in UTF format. The web server uses this date in the HTTP responses.</p>
<p>File caching improves the web server performance a lot. The following table lists the times required to load the default page from an example: </p>
<table class="doxtable">
<tr>
<th align="center">index.html not cached</th><th align="center">index.html cached  </th></tr>
<tr>
<td align="center">447.5 ms </td><td align="center">53.1 ms </td></tr>
</table>
<h2>External Web </h2>
<p>The web server also supports the browser local caching of its pages stored on SD Card. In general, files on a SD Card are bigger, thus the performance gain is much better. The available space for internal web pages is limited to the size of the internal flash memory. Thus, all large images, Java script archives and other large web resources, have to be located on an externally attached SD Card.</p>
<h3>Static Web Resources</h3>
<p>The static web resource files are copied to a SD Card when the application is built. They will not be modified later. You might use a SD Card Reader attached to your PC to copy the files. In this case, the file modification date is set correctly by the PC. If you use an embedded application to copy the files, the file modification date is most likely set to the File System default time. However, this does not create any problems for browser local caching. Once the web is locally cached by the browser, the cache is always valid and is used in subsequent browser requests.</p>
<h3>Using Web Update</h3>
<p>Web resource files, which are updated later with one of the update options provided by the Network Component, are dynamic Web resource files. You must provide the file modification date and time to the File System. If this information is not available, the File System uses a default file modification time. This might create troubles in local caching by the browser.</p>
<p>If you upload an updated web page with a wrong file modification date to the server, the web server is not able to recognize the updated files. It always reports the same Last-Modified date. The browser then uses the locally cached page instead. So the updated pages will never be used. You can force the browser to load the updated pages by manually clearing the browser cache and reloading the web page.</p>
<dl class="section note"><dt>Note</dt><dd>If the File System does not have access to Real Time Clock information, the web server will not work for updated Web pages.</dd></dl>
<h1><a class="anchor" id="ws_web_on_sd"></a>
Web on SD Card</h1>
<p>The <b>Full Web Server</b> supports storing of web pages on a SD Card, which is attached to the embedded system. This is useful if you want to update or change the web content remotely. In this case, the File System Component is used, which must be configured for a target device Memory Card Drive.</p>
<p>You can use any of the update methods to change the content of web pages:</p>
<ul>
<li><b>HTTP File Upload</b>: The web files are uploaded using a web browser. HTTP Server must be configured for the file upload.</li>
<li><b>FTP Server</b>: The web files are uploaded and managed with a FTP Client.</li>
</ul>
<h2>Web Update </h2>
<p>When the Full Web Server tries to open a web page, it searches the <b>external file system</b> first. This is usually an externally attached SD Card. As the Compact Web Server is not configured to use an external file system, it searches only the internal ROM file system.</p>
<p>If the requested file is found on SD Card, the content is sent to the web client. If the requested file does not exist on SD Card, the file with the same name is opened on the internal ROM file system and transferred to the web client. This concept allows you to simply replace the web content from internal ROM file system with a new one, that is uploaded to the external SD Card.</p>
<p>You should carefully update the <b>cgi</b> and <b>cgx</b> script files, as changes in the script files usually reflect also a changes in the application code, which is in the module <b>HTTP_Server_CGI.c</b>. If you have made a mistake in the uploaded script files, the web pages might not be accessible any more.</p>
<p>To enable the SD-Card File System, you need the select the <b>Web Server</b> in the Manage Run-Time Environment window under <b>Network:Service:Web Server</b>. The file <b>HTTP_Server_FS.c</b> will be automatically added to your project. This file contains the following interface functions for the File System and SD-Card:</p>
<ul>
<li><a class="el" href="group__net__http_func.html#gae141878f0b5761ae1678e8095050510f">http_server_fopen</a> - open a file for reading in the web server.</li>
<li><a class="el" href="group__net__http_func.html#ga7f28c5595361d3d16decb4f5e0b6cd8e">http_server_fclose</a> - close a file that was previously opened.</li>
<li><a class="el" href="group__net__http_func.html#ga4b6205c88569381be8c810b4e3aa2226">http_server_fread</a> - read a block of data from a file in the web server.</li>
<li><a class="el" href="group__net__http_func.html#ga44887ab206ed6b707fbc526f2e09048d">http_server_fgets</a> - read a string from a file in the web server.</li>
<li><a class="el" href="group__net__http_func.html#ga7d1f7422e7e08679c48ce944db49647a">http_server_ftime</a> - retrieve the last modification time of a file.</li>
</ul>
<h1><a class="anchor" id="ws_access_filtering"></a>
Access Filtering</h1>
<p>For access filtering the function <a class="el" href="group__net__http_func.html#ga5a4b5fea162e7fecf7de6a9672ceeb3f">http_accept_client</a> is used. It is part of the file HTTP_Server_Access.c. You need to adapt the function to the application's needs.</p>
<p><b>Code Example HTTP_Server_Access.c</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__net_8h.html">rl_net.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Accept or deny connection from remote HTTP client.</span></div>
<div class="line"><span class="comment">// If this function is missing, all remote clients are accepted.</span></div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="group__net__http_func.html#ga5a4b5fea162e7fecf7de6a9672ceeb3f">http_accept_client</a> (<span class="keyword">const</span> uint8_t *ip_addr, uint16_t port) {</div>
<div class="line">  <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">  if (ip_addr[0] == 192  &amp;&amp;</span></div>
<div class="line"><span class="comment">      ip_addr[1] == 168  &amp;&amp;</span></div>
<div class="line"><span class="comment">      ip_addr[2] == 0    &amp;&amp;</span></div>
<div class="line"><span class="comment">      ip_addr[3] == 1) {</span></div>
<div class="line"><span class="comment">    // Accept connection.</span></div>
<div class="line"><span class="comment">    return (true);</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  // Deny connection.</span></div>
<div class="line"><span class="comment">  return (false);</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (<span class="keyword">true</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> <h1><a class="anchor" id="ws_multilingo"></a>
Multi-language Web Pages</h1>
<p>For retrieving the preferred language from the browser, the function <a class="el" href="group__net__http_func.html#ga9de72e43415a12fe5aff144921d0eb4f">http_server_get_lang</a> is used. Please refer to the reference section for further information.</p>
<h1><a class="anchor" id="ws_multiuser"></a>
Multi-user Web Authentication</h1>
<p>Multi-user authentication allows you to create different profiles for different users or groups of users. The profiles define the access rights to different resources on the web server. All users who are allowed to access the web server are in the user database. The multi-user login also allows the Web server to create different pages depending on user.</p>
<p>If you want to use multi-user authentication, you must select <b>Enable User Authentication</b> in the <b>Net_Config_HTTP_Server.h</b> configuration file. In addition, for proper multi-user authentication, you need to add the <b>HTTP_Server_Multiuser.c</b> file to your project.</p>
<p>The account defined in the <b>Net_Config_HTTP_Server.h</b> configuration file is a system administrator account, which has no restrictions. All other accounts are created in a separate <b>HTTP_Server_Multiuser.c</b> module. To add the module to your project, simply right-click on the Source group, select <b>Add New Item to Group</b>, then click on <b>User Code Template</b> and scroll in the template files list until you find the <b>HTTP Server Multi-User</b> template.</p>
<p>The following functions are included in this module:</p>
<ul>
<li><a class="el" href="group__net__http_func.html#ga35b6f62f47735bb08ba5261522b87b9e">http_check_account</a> - checks if the user account exists for the provided credentials.</li>
<li><a class="el" href="group__net__http_func.html#ga34d2f0e562a5e226704ac38ed14a01e7">http_file_access</a> - check if the access to the file is allowed for a provided user.</li>
</ul>
<p>The following function is included in the Network Component library rl_net.h:</p>
<ul>
<li><a class="el" href="group__net__http_func.html#ga8979e7080cfe548f33ec5a377ce5cfd8">http_get_user_id</a> - retrieves the user identification number for the user, which is trying to access the resource.</li>
</ul>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__net_8h.html">rl_net.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check if an user account exist in the user database.</span></div>
<div class="line">uint8_t <a class="code" href="group__net__http_func.html#ga35b6f62f47735bb08ba5261522b87b9e">http_check_account</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *username, <span class="keyword">const</span> <span class="keywordtype">char</span> *password) {</div>
<div class="line">  <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">  if ((strcmp (username, &quot;guest&quot;) == 0) &amp;&amp; (strcmp (password, &quot;guest&quot;) == 0)) {</span></div>
<div class="line"><span class="comment">    // Accept guest account</span></div>
<div class="line"><span class="comment">    return (1);</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check if remote user is allowed to access a file on HTTP server.</span></div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="group__net__http_func.html#ga34d2f0e562a5e226704ac38ed14a01e7">http_file_access</a> (uint8_t user_id, <span class="keyword">const</span> <span class="keywordtype">char</span> *fname) {</div>
<div class="line">  <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">  if (user_id == 1) {</span></div>
<div class="line"><span class="comment">    if (strcmp (fname, &quot;system.cgi&quot;) == 0) {</span></div>
<div class="line"><span class="comment">      // User &quot;guest&quot; is not allowed to see &quot;system.cgi&quot;</span></div>
<div class="line"><span class="comment">      return (false);</span></div>
<div class="line"><span class="comment">    }</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (<span class="keyword">true</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd><ul>
<li>If the <b>HTTP_Server_Multiuser.c</b> is not added to the project, but Authentication is enabled, the web server runs in single user authentication mode.</li>
<li>You can disable a system administrator account, if you set for the <b>Authentication Username</b> an empty string.</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="using_http_server_conf"></a>
HTTP Web Server Configuration</h1>
<div class="image">
<img src="net_config_http_server_h.png" alt="net_config_http_server_h.png"/>
<div class="caption">
HTTP Web Server Configuration File</div></div>
<p> The HTTP server configuration file <b>Net_Config_HTTP_Server.h</b> contains the following settings:</p>
<ul>
<li><b>Number of Sessions</b> specifies the number of simultaneously active HTTP sessions. This number should be increased when delays are observed while loading pages in a web browser. This increases also total RAM usage. Web pages can contain many objects (like GIF or JPEG images). The remote HTTP client (web browser) opens multiple connections when downloading such pages. If there are not enough sessions configured for a parallel load, excess connections are rejected by the HTTP server. The browser then starts the socket recovery mode and retries to load missing resources. This recovery causes a delay which varies for different browsers.</li>
<li><b>Port Number</b> specifies the listening TCP port number. The default HTTP server listening port is 80.</li>
<li><b>Server-id header</b> specifies the custom HTTP server header identification. This identification is contained in each Web server response packet. When this option contains an empty string, a default Server-Id from the library is used instead.</li>
<li>The <b>Enable User Authentication</b> switch enables or disables authentication with a username and a password.<ul>
<li><b>Authentication Realm</b> is the string which is displayed in the browser's authentication dialogue if an authentication is required. This is a zero terminated string.</li>
<li><b>Authentication Username</b> is the username for authentication.</li>
<li><b>Authentication Password</b> is the default password, that must be stored in non-volatile memory. The user can change the password later. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="using_network_components.html">Using Network Components</a></li><li class="navelem"><a class="el" href="using_network_services.html">Services</a></li>
    <li class="footer">Generated on Tue May 25 2021 13:57:55 for Network Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
