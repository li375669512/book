<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>I/O Control Interface Routines</title>
<title>File System Component: I/O Control Interface Routines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">File System Component
   &#160;<span id="projectnumber">Version 6.14.1</span>
   </div>
   <div id="projectbrief">MDK Middleware for Devices with Flash File System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__ioc__interface__routines.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">I/O Control Interface Routines</div>  </div>
</div><!--header-->
<div class="contents">

<p>I/O control interface routines provide operate on FAT formatted media devices.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga5beb534c1c7b58f5a43a9d662c599bf0"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (const char *drive)</td></tr>
<tr class="memdesc:ga5beb534c1c7b58f5a43a9d662c599bf0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if valid drive is specified and return its ID.  <a href="#ga5beb534c1c7b58f5a43a9d662c599bf0">More...</a><br/></td></tr>
<tr class="separator:ga5beb534c1c7b58f5a43a9d662c599bf0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga26b09e49e049398203089eb1e7b6d29a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (int32_t drv_id)</td></tr>
<tr class="memdesc:ga26b09e49e049398203089eb1e7b6d29a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lock drive and block media access to the upper layer.  <a href="#ga26b09e49e049398203089eb1e7b6d29a">More...</a><br/></td></tr>
<tr class="separator:ga26b09e49e049398203089eb1e7b6d29a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0bc8c7ac25a252f06ebc3ead03aa820b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (int32_t drv_id)</td></tr>
<tr class="memdesc:ga0bc8c7ac25a252f06ebc3ead03aa820b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlock drive and allow media access to the upper layer.  <a href="#ga0bc8c7ac25a252f06ebc3ead03aa820b">More...</a><br/></td></tr>
<tr class="separator:ga0bc8c7ac25a252f06ebc3ead03aa820b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga94c7a0bddce171f8a3db164f047ecab0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ioc__interface__routines.html#ga94c7a0bddce171f8a3db164f047ecab0">fs_ioc_get_cache</a> (int32_t drv_id, <a class="el" href="structfs_i_o_c___cache.html">fsIOC_Cache</a> *cache_info)</td></tr>
<tr class="memdesc:ga94c7a0bddce171f8a3db164f047ecab0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return IOC cache buffer information.  <a href="#ga94c7a0bddce171f8a3db164f047ecab0">More...</a><br/></td></tr>
<tr class="separator:ga94c7a0bddce171f8a3db164f047ecab0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga57852261005a0fd076dd5eec0e007002"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ioc__interface__routines.html#ga57852261005a0fd076dd5eec0e007002">fs_ioc_read_sector</a> (int32_t drv_id, uint32_t sect, uint8_t *buf, uint32_t cnt)</td></tr>
<tr class="memdesc:ga57852261005a0fd076dd5eec0e007002"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read sector from media.  <a href="#ga57852261005a0fd076dd5eec0e007002">More...</a><br/></td></tr>
<tr class="separator:ga57852261005a0fd076dd5eec0e007002"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga903897d6bc4f6a1642ccc0fdf3ac4640"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ioc__interface__routines.html#ga903897d6bc4f6a1642ccc0fdf3ac4640">fs_ioc_write_sector</a> (int32_t drv_id, uint32_t sect, const uint8_t *buf, uint32_t cnt)</td></tr>
<tr class="memdesc:ga903897d6bc4f6a1642ccc0fdf3ac4640"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write sector to media.  <a href="#ga903897d6bc4f6a1642ccc0fdf3ac4640">More...</a><br/></td></tr>
<tr class="separator:ga903897d6bc4f6a1642ccc0fdf3ac4640"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf2eeb2a070d6d047e9521e152ef273bc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ioc__interface__routines.html#gaf2eeb2a070d6d047e9521e152ef273bc">fs_ioc_read_info</a> (int32_t drv_id, <a class="el" href="structfs_media_info.html">fsMediaInfo</a> *info)</td></tr>
<tr class="memdesc:gaf2eeb2a070d6d047e9521e152ef273bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read media configuration info.  <a href="#gaf2eeb2a070d6d047e9521e152ef273bc">More...</a><br/></td></tr>
<tr class="separator:gaf2eeb2a070d6d047e9521e152ef273bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3036c7dbc536ec052c41056245df407e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ioc__interface__routines.html#ga3036c7dbc536ec052c41056245df407e">fs_ioc_device_ctrl</a> (int32_t drv_id, <a class="el" href="rl__fs_8h.html#a46f72ffa53d0379ea0bf5e51373d1a37">fsDevCtrlCode</a> code, void *p)</td></tr>
<tr class="memdesc:ga3036c7dbc536ec052c41056245df407e"><td class="mdescLeft">&#160;</td><td class="mdescRight">IOC device control access; control code is sent directly to device driver.  <a href="#ga3036c7dbc536ec052c41056245df407e">More...</a><br/></td></tr>
<tr class="separator:ga3036c7dbc536ec052c41056245df407e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<p>I/O control interface routines provide operate on FAT formatted media devices. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga3036c7dbc536ec052c41056245df407e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fs_ioc_device_ctrl </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>drv_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="rl__fs_8h.html#a46f72ffa53d0379ea0bf5e51373d1a37">fsDevCtrlCode</a>&#160;</td>
          <td class="paramname"><em>code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>IOC device control access; control code is sent directly to device driver. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drv_id</td><td>Drive ID obtained by <a class="el" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">code</td><td>Device control code. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">p</td><td>Generic pointer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a></dd></dl>
<p>The function <b>fs_ioc_device_ctrl</b> is used to send control code directly to the device driver, causing the device to perform a corresponding operation.</p>
<p>The argument <em>drv_id</em> identifies the drive.</p>
<p>The argument <em>code</em> is specifying the control code to be sent.</p>
<p>The argument <em>p</em> is a generic pointer and is used if the control code requires additional parameters to be passed to the driver or causes return values. The object to which pointer <em>p</em> points to, depends on the control code used.</p>
<table class="doxtable">
<tr>
<th>Control code </th><th>Generic pointer</th><th>Operation description  </th></tr>
<tr>
<td>fsDevCtrlCodeCheckMedia </td><td>uint32_t </td><td>Checks presence and write protection status of a removable media. </td></tr>
<tr>
<td>fsDevCtrlCodeControlMedia</td><td>uint32_t </td><td>Control media device. </td></tr>
<tr>
<td>fsDevCtrlCodeFormat </td><td>char </td><td>Performs a low level format. </td></tr>
<tr>
<td>fsDevCtrlCodeGetCID </td><td><a class="el" href="structfs_c_i_d___register.html" title="Memory card CID register. ">fsCID_Register</a> </td><td>Reads memory card CID register. </td></tr>
<tr>
<td>fsDevCtrlCodeSerial </td><td>uint32_t </td><td>Reads device serial number. </td></tr>
<tr>
<td>fsDevCtrlCodeLockUnlock </td><td><a class="el" href="structfs_lock_unlock.html" title="Media lock/unlock information structure. ">fsLockUnlock</a> </td><td>Manage memory card password protection. </td></tr>
<tr>
<td>fsDevCtrlCodeHealthStatus</td><td><a class="el" href="structfs_health_status.html" title="Health status access structure. ">fsHealthStatus</a> </td><td>Access memory device S.M.A.R.T data. </td></tr>
</table>
<p>When <b>fsDevCtrlCodeCheckMedia</b> is specified, argument <em>p</em> is used to return the bitmask of the following values:</p>
<table class="doxtable">
<tr>
<th>Bit value </th><th>Description  </th></tr>
<tr>
<td>FS_MEDIA_INSERTED </td><td>Media device is inserted </td></tr>
<tr>
<td>FS_MEDIA_PROTECTED </td><td>Media device has write protection enabled </td></tr>
<tr>
<td>FS_MEDIA_INITIALIZED </td><td>Media device is initialized </td></tr>
<tr>
<td>FS_MEDIA_NOCHKMEDIA </td><td>Nonremovable media device or unable to detect media presence and write protection </td></tr>
</table>
<p>Argument <em>p</em> must point to valid memory location otherwise it will be rejected.</p>
<p>When <b>fsDevCtrlCodeControlMedia</b> is specified, argument <em>p</em> is used to specify the following operations:</p>
<table class="doxtable">
<tr>
<th>Value </th><th>Operation description  </th></tr>
<tr>
<td>FS_CONTROL_MEDIA_INIT </td><td>Initialize media device </td></tr>
<tr>
<td>FS_CONTROL_EMMC_SLEEP </td><td>Switch eMMC device to Sleep State and turn off VCC power supply. </td></tr>
<tr>
<td>FS_CONTROL_EMMC_AWAKE </td><td>Wake-up eMMC device from Sleep State and turn on VCC power supply. </td></tr>
</table>
<p>Argument <em>p</em> must point to valid memory location otherwise it will be rejected.</p>
<p>When <b>fsDevCtrlCodeFormat</b> is specified, argument <em>p</em> is used to specify low level format options. It can be NULL or point to char array containing following option:</p>
<table class="doxtable">
<tr>
<th>Option</th><th>Operation description  </th></tr>
<tr>
<td>LLEB </td><td>Performs low-level formatting and erases bad block markers. </td></tr>
</table>
<p>If argument <em>p</em> is NULL or unspecified options are specified, only low level format is performed which preserves bad block information.</p>
<p>When <b>fsDevCtrlCodeGetCID</b> is specified, argument <em>p</em> is used to specify the location of <a class="el" href="structfs_c_i_d___register.html">fsCID_Register</a> structure where CID register values will be stored. A NULL pointer is not allowed and will be rejected.</p>
<p>When <b>fsDevCtrlCodeSerial</b> is specified, argument <em>p</em> is used to specify the location of 32-bit variable where device serial number will be stored. A NULL pointer is not allowed and will be rejected.</p>
<p>When <b>fsDevCtrlCodeLockUnlock</b> is specified, argument <em>p</em> is used to specify the location of <a class="el" href="structfs_lock_unlock.html">fsLockUnlock</a> structure. A NULL pointer is not allowed and will be rejected.<br/>
Structure <a class="el" href="structfs_lock_unlock.html">fsLockUnlock</a> consists of the following members:</p>
<table class="doxtable">
<tr>
<th>Member </th><th>Description  </th></tr>
<tr>
<td>password </td><td>Pointer to uint8_t buffer containing password data. </td></tr>
<tr>
<td>length </td><td>Defines password length in bytes. The password length is up to 16 bytes. </td></tr>
<tr>
<td>flags </td><td>Bit mask which defines set/clear password and/or device lock/erase operation. </td></tr>
</table>
<p>Valid bit mask values for member <em>flags</em> are the following:</p>
<table class="doxtable">
<tr>
<th>Value </th><th>Description  </th></tr>
<tr>
<td>FS_DEVICE_SET_PASSWORD </td><td>Set new password. </td></tr>
<tr>
<td>FS_DEVICE_CLR_PASSWORD </td><td>Clear current password. </td></tr>
<tr>
<td>FS_DEVICE_LOCK_UNLOCK </td><td>Lock the card. Omit this flag to specify unlock operation. </td></tr>
<tr>
<td>FS_DEVICE_ERASE </td><td>Force device erase operation. </td></tr>
</table>
<p>For detailed functionality description refer to Memory Card Control Layer section <a class="el" href="mc_control_layer.html#mci_device_specifics">Device Specific Features</a>.</p>
<p>When <b>fsDevCtrlCodeHealthStatus</b> is specified, argument <em>p</em> is used to specify the location of <a class="el" href="structfs_health_status.html">fsHealthStatus</a> structure. A NULL pointer is not allowed and will be rejected.<br/>
 Structure <a class="el" href="structfs_health_status.html">fsHealthStatus</a> consists of the following members:</p>
<table class="doxtable">
<tr>
<th>Member </th><th>Description  </th></tr>
<tr>
<td>arg </td><td>Argument used to control health status access behavior. </td></tr>
<tr>
<td>buf </td><td>Defines buffer used to retrieve or to write data and must be 4 byte aligned. </td></tr>
<tr>
<td>buf_sz </td><td>Defines buffer size in bytes. </td></tr>
</table>
<p>The behavior of fsDevCtrlCodeHealthStatus is device specific and only supported for eMMC and SD devices. See Memory Card Control Layer section <a class="el" href="mc_control_layer.html#mci_device_specifics">Device Specific Features</a> for more information.</p>
<p><b>Code Examples</b> </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> tst_device_status (<span class="keywordtype">void</span>) {</div>
<div class="line">  int32_t  id;</div>
<div class="line">  uint32_t status;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">id</span> = <a class="code" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (<span class="stringliteral">&quot;M:&quot;</span>);</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (<span class="keywordtype">id</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__ioc__interface__routines.html#ga3036c7dbc536ec052c41056245df407e">fs_ioc_device_ctrl</a> (<span class="keywordtype">id</span>, <a class="code" href="rl__fs_8h.html#a46f72ffa53d0379ea0bf5e51373d1a37af1fae054ae12b5ec9c18dbde9e21637b">fsDevCtrlCodeCheckMedia</a>, &amp;status) == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>) {</div>
<div class="line">    <span class="keywordflow">if</span> (status &amp; <a class="code" href="rl__fs_8h.html#ab8fb7e728316dfc28c5da789d6da2d2d">FS_MEDIA_INSERTED</a>) {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Removable media is present.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (status &amp; <a class="code" href="rl__fs_8h.html#a9ce1de3d766049d2321b0391f734b044">FS_MEDIA_PROTECTED</a>) {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Removable media is write protected.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (status &amp; <a class="code" href="rl__fs_8h.html#a42e30de89224fd195b40661d9df848d4">FS_MEDIA_INITIALIZED</a>) {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Removable media is initialized.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (status &amp; <a class="code" href="rl__fs_8h.html#a62de394e305a8ea4f5fa2ab319c02c7f">FS_MEDIA_NOCHKMEDIA</a>) {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Unable to detect media presence and media write protection.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (<span class="keywordtype">id</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="keywordtype">void</span> get_device_serial (<span class="keywordtype">void</span>) {</div>
<div class="line">  int32_t  id;</div>
<div class="line">  uint32_t serial;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">id</span> = <a class="code" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (<span class="stringliteral">&quot;M:&quot;</span>);</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (<span class="keywordtype">id</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__ioc__interface__routines.html#ga3036c7dbc536ec052c41056245df407e">fs_ioc_device_ctrl</a> (<span class="keywordtype">id</span>, <a class="code" href="rl__fs_8h.html#a46f72ffa53d0379ea0bf5e51373d1a37af3abe55a52031513d1c6d8ad3f1d4f78">fsDevCtrlCodeSerial</a>, &amp;serial) == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>) {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Device serial number is %d.\n&quot;</span>, serial);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (<span class="keywordtype">id</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="keywordtype">void</span> read_cid (<span class="keywordtype">void</span>) {</div>
<div class="line">  int32_t        id;</div>
<div class="line">  <a class="code" href="structfs_c_i_d___register.html">fsCID_Register</a> cid;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">id</span> = <a class="code" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (<span class="stringliteral">&quot;M:&quot;</span>);</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (<span class="keywordtype">id</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__ioc__interface__routines.html#ga3036c7dbc536ec052c41056245df407e">fs_ioc_device_ctrl</a> (<span class="keywordtype">id</span>, <a class="code" href="rl__fs_8h.html#a46f72ffa53d0379ea0bf5e51373d1a37a231e62c1fd62dd7d2cb78740b30b5cf5">fsDevCtrlCodeGetCID</a>, &amp;cid) == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>) {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Manufacturer ID: %d (0x%.2X)\n&quot;</span>, cid.<a class="code" href="structfs_c_i_d___register.html#a74b374f094f3637dde09b84a823203e1">MID</a>, cid.<a class="code" href="structfs_c_i_d___register.html#a74b374f094f3637dde09b84a823203e1">MID</a>);</div>
<div class="line">    printf (<span class="stringliteral">&quot;OEM/Application ID: %c%c\n&quot;</span>,     cid.<a class="code" href="structfs_c_i_d___register.html#a9b720181e1b1925ea4665c933e1c862f">OID</a> &gt;&gt; 8, cid.<a class="code" href="structfs_c_i_d___register.html#a9b720181e1b1925ea4665c933e1c862f">OID</a> &amp; 0xFF);</div>
<div class="line">    printf (<span class="stringliteral">&quot;Product name: %c%c%c%c%c\n&quot;</span>,     cid.<a class="code" href="structfs_c_i_d___register.html#ad03fba5113a186464b1d4e4a5d6032eb">PNM</a>[0], cid.<a class="code" href="structfs_c_i_d___register.html#ad03fba5113a186464b1d4e4a5d6032eb">PNM</a>[1], cid.<a class="code" href="structfs_c_i_d___register.html#ad03fba5113a186464b1d4e4a5d6032eb">PNM</a>[2], cid.<a class="code" href="structfs_c_i_d___register.html#ad03fba5113a186464b1d4e4a5d6032eb">PNM</a>[3], cid.<a class="code" href="structfs_c_i_d___register.html#ad03fba5113a186464b1d4e4a5d6032eb">PNM</a>[4]);</div>
<div class="line">    printf (<span class="stringliteral">&quot;Product revision: %d.%d\n&quot;</span>,      cid.<a class="code" href="structfs_c_i_d___register.html#af19ab4ef40d03268610a19466e076690">PRV</a> &gt;&gt; 4, cid.<a class="code" href="structfs_c_i_d___register.html#af19ab4ef40d03268610a19466e076690">PRV</a> &amp; 0x0F);</div>
<div class="line">    printf (<span class="stringliteral">&quot;Product serial number: 0x%X\n&quot;</span>,  cid.<a class="code" href="structfs_c_i_d___register.html#a28233480ee3137457c4631321f3468a7">PSN</a>);</div>
<div class="line">    printf (<span class="stringliteral">&quot;Manufacturing date: %d/%.2d\n&quot;</span>,  cid.<a class="code" href="structfs_c_i_d___register.html#a71d882934b994b2187a42419b56f41e1">MDT</a> &amp; 0x0F, cid.<a class="code" href="structfs_c_i_d___register.html#a71d882934b994b2187a42419b56f41e1">MDT</a> &gt;&gt; 4);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (<span class="keywordtype">id</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="keywordtype">void</span> format_nand (<span class="keywordtype">void</span>) {</div>
<div class="line">  int32_t id;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">id</span> = <a class="code" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (<span class="stringliteral">&quot;N:&quot;</span>);</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (<span class="keywordtype">id</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__ioc__interface__routines.html#ga3036c7dbc536ec052c41056245df407e">fs_ioc_device_ctrl</a> (<span class="keywordtype">id</span>, <a class="code" href="rl__fs_8h.html#a46f72ffa53d0379ea0bf5e51373d1a37af63bbad6b978d3619ff6ad8f63fee0a5">fsDevCtrlCodeFormat</a>, NULL) == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>) {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Low level NAND formatting succeeded.\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (<span class="keywordtype">id</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="comment">// Memory card password</span></div>
<div class="line">uint8_t pass[] = <span class="stringliteral">&quot;12345&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Media lock/unlock information structure</span></div>
<div class="line"><a class="code" href="structfs_lock_unlock.html">fsLockUnlock</a> mc_lock;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Password management function</span></div>
<div class="line"><span class="keywordtype">void</span> mc_password_manage (uint32_t operation) {</div>
<div class="line">  int32_t id;</div>
<div class="line">  <a class="code" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a> status;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Set password data buffer and password length</span></div>
<div class="line">  mc_lock.<a class="code" href="structfs_lock_unlock.html#a773ded056dd281136ab3818caf4004ba">password</a> = pass;</div>
<div class="line">  mc_lock.<a class="code" href="structfs_lock_unlock.html#a4ea0c21c051070a4f7f2192f6a480ff3">length</a>   = 5;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">switch</span> (operation) {</div>
<div class="line">    <span class="keywordflow">case</span> 0: <span class="comment">// Set password and lock memory card</span></div>
<div class="line">      mc_lock.<a class="code" href="structfs_lock_unlock.html#a8d375c9275dd0e7aa80435ee55217e91">flags</a> = <a class="code" href="rl__fs_8h.html#a4dcee13db9af51353d3509331d6ded8f">FS_DEVICE_SET_PASSWORD</a> | <a class="code" href="rl__fs_8h.html#a615e2a30a6833ad0ad79e7186cbbad1b">FS_DEVICE_LOCK_UNLOCK</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> 1: <span class="comment">// Set password</span></div>
<div class="line">      mc_lock.<a class="code" href="structfs_lock_unlock.html#a8d375c9275dd0e7aa80435ee55217e91">flags</a> = <a class="code" href="rl__fs_8h.html#a4dcee13db9af51353d3509331d6ded8f">FS_DEVICE_SET_PASSWORD</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> 2: <span class="comment">// Clear password</span></div>
<div class="line">      mc_lock.<a class="code" href="structfs_lock_unlock.html#a8d375c9275dd0e7aa80435ee55217e91">flags</a> = <a class="code" href="rl__fs_8h.html#aefaaef5e8f9772c0f36704f5168fe312">FS_DEVICE_CLR_PASSWORD</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> 3: <span class="comment">// Lock memory card</span></div>
<div class="line">      mc_lock.<a class="code" href="structfs_lock_unlock.html#a8d375c9275dd0e7aa80435ee55217e91">flags</a> = <a class="code" href="rl__fs_8h.html#a615e2a30a6833ad0ad79e7186cbbad1b">FS_DEVICE_LOCK_UNLOCK</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> 4: <span class="comment">//Unlock memory card</span></div>
<div class="line">      mc_lock.<a class="code" href="structfs_lock_unlock.html#a8d375c9275dd0e7aa80435ee55217e91">flags</a> = 0;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> 5: <span class="comment">// Force device erase (forgotten password)</span></div>
<div class="line">      mc_lock.<a class="code" href="structfs_lock_unlock.html#a8d375c9275dd0e7aa80435ee55217e91">flags</a> = <a class="code" href="rl__fs_8h.html#a94e215f84b9683736f1c6d7a574d8875">FS_DEVICE_ERASE</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">id</span> = <a class="code" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (<span class="stringliteral">&quot;M0:&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; 0) {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Invalid drive specified!\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (<span class="keywordtype">id</span>);</div>
<div class="line">    <span class="comment">// Execute memory card lock/unlock operation</span></div>
<div class="line">    status = <a class="code" href="group__ioc__interface__routines.html#ga3036c7dbc536ec052c41056245df407e">fs_ioc_device_ctrl</a> (<span class="keywordtype">id</span>, <a class="code" href="rl__fs_8h.html#a46f72ffa53d0379ea0bf5e51373d1a37a1c907bf83317635be0bdb40a3231da23">fsDevCtrlCodeLockUnlock</a>, &amp;mc_lock);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (status == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>) {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Operation succeeded!\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7af8c3d2bcf339de44bdc273412431e098">fsAccessDenied</a>) {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Invalid password data. Operation failed!\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Operation failed! Error no.: %d\n&quot;</span>, status);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (<span class="keywordtype">id</span>);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cmsis_compiler.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 4-byte aligned buffer to store eMMC/SD card S.M.A.R.T data</span></div>
<div class="line">uint8_t SMART_Data[512] __ALIGNED(4U);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> get_health_status (<span class="keywordtype">void</span>) {</div>
<div class="line">  int32_t id;</div>
<div class="line">  <a class="code" href="structfs_health_status.html">fsHealthStatus</a> cmd;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">id</span>  = <a class="code" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (<span class="stringliteral">&quot;M:&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &gt;= 0 &amp;&amp; (<a class="code" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (<span class="keywordtype">id</span>) == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>)) {</div>
<div class="line">    <span class="comment">// Prepare health status access argument and buffer</span></div>
<div class="line">    cmd.<a class="code" href="structfs_health_status.html#ae9675ffc01a72697b5e4923e042c0d78">arg</a>    = 1;</div>
<div class="line">    cmd.<a class="code" href="structfs_health_status.html#a07d14bd491f5711125a12b0c68179fc3">buf</a>    = SMART_Data;</div>
<div class="line">    cmd.<a class="code" href="structfs_health_status.html#a1a9fc03f0faaf38a587a34b34f47d19d">buf_sz</a> = <span class="keyword">sizeof</span>(SMART_Data);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__ioc__interface__routines.html#ga3036c7dbc536ec052c41056245df407e">fs_ioc_device_ctrl</a> (<span class="keywordtype">id</span>, <a class="code" href="rl__fs_8h.html#a46f72ffa53d0379ea0bf5e51373d1a37ab0fd8541b0842669d009df84fc5c2aba">fsDevCtrlCodeHealthStatus</a>, &amp;cmd) == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>) {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Health status was sucessfully retrieved.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Failed to access memory device health status.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (<span class="keywordtype">id</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> printf (<span class="stringliteral">&quot;Specified drive doesn&#39;t exists!&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="ga94c7a0bddce171f8a3db164f047ecab0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fs_ioc_get_cache </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>drv_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfs_i_o_c___cache.html">fsIOC_Cache</a> *&#160;</td>
          <td class="paramname"><em>cache_info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return IOC cache buffer information. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drv_id</td><td>Drive ID obtained by <a class="el" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cache_info</td><td>IOC Cache information. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful.</li>
<li>fsInvalidParameter = Input parameters are not valid.</li>
<li>fsInvalidDrive = Nonexistent drive ID specified.</li>
<li>fsAccessDenied = IOC access not allowed for specified drive.</li>
</ul>
</dd></dl>
<p>The function <b>fs_ioc_get_cache</b> is used to gain information about the file system cache buffer location and its size. The I/O Control Interface can use this buffer as a temporary storage for sector operations using <a class="el" href="group__ioc__interface__routines.html#ga57852261005a0fd076dd5eec0e007002">fs_ioc_read_sector</a> and <a class="el" href="group__ioc__interface__routines.html#ga903897d6bc4f6a1642ccc0fdf3ac4640">fs_ioc_write_sector</a> or for any other data storage.</p>
<p>The argument <em>cache_info</em> is a pointer to the <a class="el" href="structfs_i_o_c___cache.html">fsIOC_Cache</a> structure where the buffer location and its size will be stored.</p>
<dl class="section note"><dt>Note</dt><dd>The buffer size is defined in the configuration file for a particular drive using <b>File System Cache</b> setting.</dd></dl>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> chk_cache_buffer (<span class="keywordtype">void</span>) {</div>
<div class="line">  <a class="code" href="structfs_i_o_c___cache.html">fsIOC_Cache</a> info;</div>
<div class="line">  int32_t id;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">id</span> = <a class="code" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (<span class="stringliteral">&quot;M:&quot;</span>);</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (<span class="keywordtype">id</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__ioc__interface__routines.html#ga94c7a0bddce171f8a3db164f047ecab0">fs_ioc_get_cache</a> (<span class="keywordtype">id</span>, &amp;info) == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>) {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Cache buffer location: 0x%X\n&quot;</span>, info.<a class="code" href="structfs_i_o_c___cache.html#a6a136604fd0fc8ac8db34c89e25a4b42">buffer</a>);</div>
<div class="line">    printf (<span class="stringliteral">&quot;Cache buffer size: %d bytes.\n&quot;</span>, info.<a class="code" href="structfs_i_o_c___cache.html#a63d794bea674218214d68a8c9b4287b7">size</a>);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (<span class="keywordtype">id</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="ga5beb534c1c7b58f5a43a9d662c599bf0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t fs_ioc_get_id </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>drive</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if valid drive is specified and return its ID. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drive</td><td>a string specifying the <a class="el" href="fs_operation.html#drive">memory or storage device</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>drive ID or execution status<ul>
<li>value &gt;= 0: drive ID as an integer when specified drive exists and allows IOC access</li>
<li>value &lt; 0: error occurred, -value is execution status as defined with <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a></li>
</ul>
</dd></dl>
<p>The function <b>fs_ioc_get_id</b> is used to get the drive identifier associated with the specified drive letter.</p>
<p>The argument <em>drive</em> is specifying a FAT volume <a class="el" href="fs_operation.html#drive">drive</a>. The <a class="el" href="fs_operation.html#cur_sys_drive">Current Drive</a> is used, if an empty string "" is provided. </p>

</div>
</div>
<a class="anchor" id="ga26b09e49e049398203089eb1e7b6d29a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fs_ioc_lock </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>drv_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Lock drive and block media access to the upper layer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drv_id</td><td>Drive ID obtained by <a class="el" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful.</li>
<li>fsInvalidDrive = Nonexistent drive ID specified.</li>
<li>fsAccessDenied = IOC access not allowed for specified drive.</li>
</ul>
</dd></dl>
<p>The function <b>fs_ioc_lock</b> locks a drive in order to block media access to the file system layer while the I/O Control Interface routines are in use. The I/O Control Interface should only be used in the locked state due to possible interference with file system accesses to the media. All file operations will fail while the drive is in the locked state. The function <a class="el" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> is used to unlock the drive.</p>
<p>The argument <em>drv_id</em> identifies the drive and must be obtained using the <a class="el" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> function. </p>

</div>
</div>
<a class="anchor" id="gaf2eeb2a070d6d047e9521e152ef273bc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fs_ioc_read_info </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>drv_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfs_media_info.html">fsMediaInfo</a> *&#160;</td>
          <td class="paramname"><em>info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read media configuration info. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drv_id</td><td>Drive ID obtained by <a class="el" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">info</td><td>Media information structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful.</li>
<li>fsInvalidDrive = Nonexistent drive ID specified.</li>
<li>fsNoMedia = Media not present.</li>
<li>fsAccessDenied = IOC access not allowed for specified drive.</li>
<li>fsError = Media information read failed.</li>
</ul>
</dd></dl>
<p>The function <b>fs_ioc_read_info</b> reads the media configuration.</p>
<p>The argument <em>drv_id</em> identifies the drive.</p>
<p>The argument <em>info</em> returns the media information structure as specified in <a class="el" href="structfs_media_info.html">fsMediaInfo</a>.</p>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> get_device_size (<span class="keywordtype">void</span>) {</div>
<div class="line">  <a class="code" href="structfs_media_info.html">fsMediaInfo</a> info;</div>
<div class="line">  int32_t id;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">id</span> = <a class="code" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (<span class="stringliteral">&quot;M:&quot;</span>);</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (<span class="keywordtype">id</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__ioc__interface__routines.html#gaf2eeb2a070d6d047e9521e152ef273bc">fs_ioc_read_info</a> (<span class="keywordtype">id</span>, &amp;info) == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>) {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Device size is %d bytes.\n&quot;</span>, info.<a class="code" href="structfs_media_info.html#a1d5f265d12fec241f51d729dd9569243">block_cnt</a> * info.<a class="code" href="structfs_media_info.html#a0f5f8f12d4d56a72abb33d735a3cbebf">read_blen</a>);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (<span class="keywordtype">id</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="ga57852261005a0fd076dd5eec0e007002"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fs_ioc_read_sector </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>drv_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>sect</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>cnt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read sector from media. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drv_id</td><td>Drive ID obtained by <a class="el" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sect</td><td>Sector number. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>Data buffer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cnt</td><td>Count of sectors. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful.</li>
<li>fsInvalidDrive = Nonexistent drive ID specified.</li>
<li>fsNoMedia = Media not present.</li>
<li>fsAccessDenied = IOC access not allowed for specified drive.</li>
<li>fsError = Read sector failed.</li>
</ul>
</dd></dl>
<p>The function <b>fs_ioc_read_sector</b> reads data from one or more sectors of FAT formatted media.</p>
<p>The argument <em>drv_id</em> identifies the drive.</p>
<p>The argument <em>sect</em> specifies the starting sector from where to read the data.</p>
<p>The argument <em>buf</em> is a pointer to the buffer that stores the data.</p>
<p>The argument <em>cnt</em> specifies the number of sectors to read.</p>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> sector_read (uint32_t sector_addr, uint8_t *buf) {</div>
<div class="line">  int32_t id;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">id</span> = <a class="code" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (<span class="stringliteral">&quot;U:&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (<span class="keywordtype">id</span>) == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>) {</div>
<div class="line">    <a class="code" href="group__ioc__interface__routines.html#ga57852261005a0fd076dd5eec0e007002">fs_ioc_read_sector</a> (<span class="keywordtype">id</span>, sector_addr, buf, 1);</div>
<div class="line">    <a class="code" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (<span class="keywordtype">id</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="ga0bc8c7ac25a252f06ebc3ead03aa820b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fs_ioc_unlock </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>drv_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlock drive and allow media access to the upper layer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drv_id</td><td>Drive ID obtained by <a class="el" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful.</li>
<li>fsInvalidDrive = Nonexistent drive ID specified.</li>
<li>fsAccessDenied = IOC access not allowed for specified drive.</li>
</ul>
</dd></dl>
<p>The function <b>fs_ioc_unlock</b> unlocks a drive and releases media access to the file system layer. The I/O Control Interface should only be used in the locked state due to possible interference with file system accesses to the media. The function <a class="el" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> is used to lock the drive.</p>
<p>The argument <em>drv_id</em> identifies the drive and must be obtained using the <a class="el" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> function. </p>

</div>
</div>
<a class="anchor" id="ga903897d6bc4f6a1642ccc0fdf3ac4640"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rl__fs_8h.html#a326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fs_ioc_write_sector </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>drv_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>sect</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>cnt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write sector to media. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drv_id</td><td>Drive ID obtained by <a class="el" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sect</td><td>Sector number. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>Data buffer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cnt</td><td>Count of sectors. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful.</li>
<li>fsInvalidDrive = Nonexistent drive ID specified.</li>
<li>fsNoMedia = Media not present.</li>
<li>fsAccessDenied = IOC access not allowed for specified drive.</li>
<li>fsError = Read sector failed.</li>
</ul>
</dd></dl>
<p>The function <b>fs_ioc_write_sector</b> writes data to one or more sectors of FAT formatted media.</p>
<p>The argument <em>drv_id</em> identifies the drive.</p>
<p>The argument <em>sect</em> specifies the starting sector to write the data.</p>
<p>The argument <em>buf</em> is a pointer to the buffer that contains the data to write.</p>
<p>The argument <em>cnt</em> specifies the number of sectors to write to.</p>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> sector_write (uint32_t sector_addr, <span class="keyword">const</span> uint8_t *buf) {</div>
<div class="line">  int32_t id;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">id</span> = <a class="code" href="group__ioc__interface__routines.html#ga5beb534c1c7b58f5a43a9d662c599bf0">fs_ioc_get_id</a> (<span class="stringliteral">&quot;U:&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__ioc__interface__routines.html#ga26b09e49e049398203089eb1e7b6d29a">fs_ioc_lock</a> (<span class="keywordtype">id</span>) == <a class="code" href="group__status__error__codes__fs.html#gga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8">fsOK</a>) {</div>
<div class="line">    <a class="code" href="group__ioc__interface__routines.html#ga903897d6bc4f6a1642ccc0fdf3ac4640">fs_ioc_write_sector</a> (<span class="keywordtype">id</span>, sector_addr, buf, 1);</div>
<div class="line">    <a class="code" href="group__ioc__interface__routines.html#ga0bc8c7ac25a252f06ebc3ead03aa820b">fs_ioc_unlock</a> (<span class="keywordtype">id</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue May 25 2021 13:57:20 for File System Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
