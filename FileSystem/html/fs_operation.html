<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Theory of Operation</title>
<title>File System Component: Theory of Operation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">File System Component
   &#160;<span id="projectnumber">Version 6.14.1</span>
   </div>
   <div id="projectbrief">MDK Middleware for Devices with Flash File System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fs_operation.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Theory of Operation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#fs_usage">Using the File System</a></li>
<li class="level1"><a href="#drive">Drives, Memory Devices and Drivers</a></li>
</ul>
</div>
<div class="textblock"><p>The File System Component provides functions to create, save, read, and modify files. The Retarget Interface of the ARM C/C++ compiler run-time library allows the usage of ANSI C standard file I/O functions. The File System Component is designed for Cortex-M processor-based devices and requires an CMSIS-RTOS compliant real-time operating system for thread-safe operation.</p>
<p>The File System Component consists of two different file systems, placed on top of different layers, depending on the media type:</p>
<ul>
<li><a class="el" href="fat_fs.html">FAT File System</a> (using FAT12, FAT16, or FAT32) is used for <a class="el" href="fs_create_app.html#mc_usage">memory card</a> devices, <a class="el" href="fs_create_app.html#usb_usage">USB Memory sticks</a>, <a class="el" href="fs_create_app.html#nand_usage">NAND Flash</a> devices, and <a class="el" href="fs_create_app.html#ram_usage">RAM disks</a>. FAT is a standard file system used on many computers.</li>
<li><a class="el" href="emb_fs.html">Embedded File System (EFS)</a> is optimized for <a class="el" href="fs_create_app.html#nor_usage">NOR Flash</a> memory devices.</li>
<li><a class="el" href="journaling_fat.html">Journaling for the FAT File System</a> is an extension to the <a class="el" href="fat_fs.html">FAT File System</a> that helps to keep the file system consistent in an embedded system.</li>
<li>The <a class="el" href="mc_control_layer.html">Memory Card Control Layer</a> is used to control SDxC/MMC/eMMC memory devices.</li>
<li>The <a class="el" href="nand_flash__t_l.html">NAND Flash Translation Layer</a> provides means of wear leveling, bad block management, and error correction on <a class="el" href="fs_create_app.html#nand_usage">NAND Flash</a> devices.</li>
</ul>
<h1><a class="anchor" id="fs_usage"></a>
Using the File System</h1>
<p>The File System Component integrates with the ARM Standard Run-Time Library and requires a CMSIS-RTOS compliant RTOS. It cannot be used with the ARM MicroLIB library since this library does not provide the hooks for I/O file handling.</p>
<p>The following picture shows the File System's structure from a developer's perspective.</p>
<div class="image">
<img src="fs_structure.png" alt="fs_structure.png"/>
<div class="caption">
File System Component Structure</div></div>
<ul>
<li><b>System, File Management</b>: functions that manage the File System and provide operation to format a drive and manage files and directories.</li>
<li><b>Standard File I/O</b>: functions to perform input and output operations on files, such as read, write, and seek.</li>
<li><b>ARM Standard Run-Time Library</b>: is the ARM Compiler standard C library with functions to manage file.</li>
<li><b>FS_Config.c</b>: configuration file for general characteristics of the file system.</li>
<li><b>FS_Config_<em>xxx_n</em>.h</b>: configuration file for the characteristics of each drive or media(MC, NAND, NOR, RAM, or USB memory sticks).</li>
<li><b>File System Core</b>: handles low-level input and output file operations (some are re-targeted to use the ARM Standard Run-Time Library). Depending on configuration settings, it uses the appropriate file system (FAT or EFS) and implements the NAND Flash Translation Layer.</li>
<li><b>IOC - FAT Media API</b>: are I/O Control Interface Routines for the FAT file system to access physical sectors.</li>
<li><b>FAT, EFS Media</b>: the FAT file system supports Memory Cards (MC), NAND Flash, and USB memory sticks, and RAM disks. The Embedded File System (EFS) supports NOR Flash devices.</li>
<li><b>Drivers</b> The File System Core accesses the drives via CMSIS-Drivers that are typically part of the Device Family Pack. Every drive uses dedicated driver.</li>
</ul>
<p>The configuration steps and files that are needed to create applications for the different devices are explained here:</p>
<ul>
<li><a class="el" href="fs_create_app.html#nor_usage">NOR Flash Drive</a></li>
<li><a class="el" href="fs_create_app.html#ram_usage">RAM Disk Drive</a></li>
<li><a class="el" href="fs_create_app.html#mc_usage">Memory Card Drive</a></li>
<li><a class="el" href="fs_create_app.html#usb_usage">USB Flash Drive</a></li>
<li><a class="el" href="fs_create_app.html#nand_usage">NAND Flash Drive</a></li>
</ul>
<h1><a class="anchor" id="drive"></a>
Drives, Memory Devices and Drivers</h1>
<p>The File System Component supports various memory and storage devices that are assigned to a <b>drive</b>.</p>
<div class="image">
<img src="fs_types.png" alt="fs_types.png"/>
<div class="caption">
File System Component: Media types and Drives</div></div>
<p> All available drives are defined with the <a class="el" href="fs_create_app.html#fs_RTE_Software_Component_Selection">RTE Component Selection</a>. A drive is passed as string to <a class="el" href="group__system__routines.html">System Routines</a> and may be part of a filename. The system allows you to configure a current drive that is used when no drive is specified as part of the filename.</p>
<p>The file system type is automatically chosen depending on the drive type (which correlates to a certain memory device). Some drives may use different interfaces that will be covered by appropriate CMSIS-Drivers. The following table shows the relationship between drive - memory device - and driver/interface:</p>
<table class="doxtable">
<tr>
<th align="left">Drive </th><th align="center">File System </th><th align="left">Drive Type </th><th>CMSIS-Driver/Interface  </th></tr>
<tr>
<td align="left">"F:" or "F0:"</td><td align="center"><a class="el" href="emb_fs.html">EFS</a> </td><td align="left">NOR Flash drive 0 </td><td> <script>link_ext('Flash-API');</script> (Memory Bus or <script>link_ext('SPI-API');</script> </td></tr>
<tr>
<td align="left">"F1:" </td><td align="center"><a class="el" href="emb_fs.html">EFS</a> </td><td align="left">NOR Flash drive 1 </td><td> <script>link_ext('Flash-API');</script> (Memory Bus or <script>link_ext('SPI-API');</script> </td></tr>
<tr>
<td align="left">"R:" or "R0:"</td><td align="center"><a class="el" href="fat_fs.html">FAT</a> </td><td align="left">RAM drive </td><td>N/A </td></tr>
<tr>
<td align="left">"M:" or "M0:"</td><td align="center"><a class="el" href="fat_fs.html">FAT</a> </td><td align="left">Memory Card drive 0 </td><td> <script>link_ext('MCI-API');</script> or <script>link_ext('SPI-API');</script> </td></tr>
<tr>
<td align="left">"M1:" </td><td align="center"><a class="el" href="fat_fs.html">FAT</a> </td><td align="left">Memory Card drive 1 </td><td> <script>link_ext('MCI-API');</script> or <script>link_ext('SPI-API');</script> </td></tr>
<tr>
<td align="left">"U:" or "U0:"</td><td align="center"><a class="el" href="fat_fs.html">FAT</a> </td><td align="left">USB Memory Stick drive 0 </td><td> <script>link_ext('USB-API');</script> </td></tr>
<tr>
<td align="left">"U1:" </td><td align="center"><a class="el" href="fat_fs.html">FAT</a> </td><td align="left">USB Memory Stick drive 1 </td><td> <script>link_ext('USB-API');</script> </td></tr>
<tr>
<td align="left">"N:" or "N0:"</td><td align="center"><a class="el" href="fat_fs.html">FAT</a> </td><td align="left">NAND Flash drive 0 </td><td> <script>link_ext('NAND-API');</script> (Memory Bus) </td></tr>
<tr>
<td align="left">"N1:" </td><td align="center"><a class="el" href="fat_fs.html">FAT</a> </td><td align="left">NAND Flash drive 1 </td><td> <script>link_ext('NAND-API');</script> (Memory Bus) </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>NOR Flash is typically connected over Memory Bus or SPI. For using a NOR Flash drive, a Flash driver is required which encapsulates either the Memory Bus interface or SPI (in which case an SPI driver required in addition).</li>
<li>The Middleware Component contains example drivers for Flash devices that can be used to implement other device drivers if required. The examples are: AM29x800BB/<a href="https://www.micron.com/~/media/documents/products/data-sheet/nor-flash/parallel/m29w/m29w640f.pdf" target="_blank">M29W640FB</a> (Flash with 16-bit memory bus interface), <a href="http://www.spansion.com/Support/Datasheets/s29gl-n_01.pdf" target="_blank">S29GL064Nx2</a> (Flash with 32-bit memory bus interface), and <a href="http://www.atmel.com/images/doc1638.pdf" target="_blank">AT45DB642D</a> (Flash with SPI interface using an SPI driver).</li>
<li>Other drives (memory card, USB memory device, NAND Flash) require appropriate CMSIS-Driver for the microcontroller device. If no suitable CMSIS-Driver is available for your selected device, you may create the required Flash interface driver. Refer to the <script>link_ext('CMSIS-Driver-Ref');</script> for details.</li>
<li>Currently, using NAND Flash devices with SPI interface (Serial NAND) <em>is</em> <em>not</em> <em>supported</em>.</li>
</ul>
</dd></dl>
<p><a class="anchor" id="cur_sys_drive"></a></p>
<h2>Current Drive </h2>
<p>The <b>Current Drive</b> defines the drive used when the filename itself does not specify the drive or when functions that expect a drive are called with an empty ("") string.</p>
<p>An <b>Initial Current Drive</b> is defined in the <b>FS_Config.c</b> configuration file and is used at startup to set the <a class="el" href="fs_operation.html#cur_sys_drive">Current Drive</a>. The <a class="el" href="fs_operation.html#cur_sys_drive">Current Drive</a> can be changed during run-time using the function <a class="el" href="group__utility__routines.html#ga75a680af8cbd2e2fae87d99d9ab50e11">fchdrive</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue May 25 2021 13:57:20 for File System Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
