<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>USB Host (MDK-Professional only)</title>
<title>USB Component: USB Host (MDK-Professional only)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">USB Component
   &#160;<span id="projectnumber">Version 6.15.0</span>
   </div>
   <div id="projectbrief">MDK Middleware for USB Device and Host Communication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_u_s_b__host.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">USB Host (MDK-Professional only) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Create_a_USB_Host_Application">Create an Application</a><ul><li class="level2"><a href="#RTE_Software_Component_Selection_USBH">RTE Component Selection</a></li>
<li class="level2"><a href="#USB_Driver_Configuration_USBH">USB Driver and Controller</a></li>
<li class="level2"><a href="#USB_Host_Configuration_USBH">USB Host Configuration</a></li>
<li class="level2"><a href="#usbh_system_resources">System Resource Configuration</a></li>
<li class="level2"><a href="#USB_Device_Class_Configuration_USBH">Configuration of Attachable USB Devices</a></li>
<li class="level2"><a href="#USBH_User_Code_Implementation">User Code Implementation</a></li>
<li class="level2"><a href="#usbh_debugging">Debugging</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>This chapter describes the software structure of the USB Host Component and explains its use for creating a USB Host application. This software component is available to users of MDK-Professional only.</p>
<p>The USB Host Component simplifies software development of microcontroller systems that allow to connect USB Devices. The attributes of the USB Host Component are:</p>
<ul>
<li>Complies with the USB 2.0 specification.</li>
<li>Support for <a class="el" href="_h_i_d.html">HID</a>, <a class="el" href="_m_s_c.html">MSC</a>, <a class="el" href="_c_d_c.html">CDC</a>, and <a class="el" href="_custom_class.html">Custom</a> USB Device Classes to be connected to the USB Host.</li>
<li>Support for <a class="el" href="_u_s_b__control__transfers.html">control</a>, <a class="el" href="_u_s_b__interrupt__transfers.html">interrupt</a> and <a class="el" href="_u_s_b__bulk__transfers.html">bulk</a> transfer types.</li>
</ul>
<h2>RTE Components </h2>
<p>The following picture shows the relationships of the RTE Components with the microcontroller's USB Host peripheral (USB Controller). RTE Components provide configuration files and user code templates. <b>Configuration files</b> configure the RTE Components, hardware interfaces, memory resources and USB Host parameters. <b>User code templates</b> provide the skeleton for implementing support for different USB Device classes.</p>
<div class="image">
<img src="usb_host_blocks_config_files.png" alt="usb_host_blocks_config_files.png"/>
<div class="caption">
USB Host Structure</div></div>
<h1><a class="anchor" id="Create_a_USB_Host_Application"></a>
Create an Application</h1>
<p>The steps to create a microcontroller application that functions as an USB Host are:</p>
<ol type="1">
<li>Select <a class="el" href="_u_s_b__host.html#RTE_Software_Component_Selection_USBH">RTE Components</a> that are required for your application.</li>
<li><a class="el" href="_u_s_b__host.html#USB_Driver_Configuration_USBH">Enable and configure the USB Host Driver</a>.</li>
<li>Configure the <a class="el" href="_u_s_b__host.html#USB_Host_Configuration_USBH">USB Host</a> that connects the USB Middleware to the microcontroller USB peripheral.</li>
<li>Configure the <a class="el" href="_u_s_b__host.html#usbh_system_resources">System Resources</a> according to the USB Host component's <a class="el" href="usb_resource_requirements.html#usbh_res_req">Resource Requirements</a>.</li>
<li>Configure the parameters of the attached <a class="el" href="_u_s_b__host.html#USB_Device_Class_Configuration_USBH">USB Devices</a>.</li>
<li>Implement the <a class="el" href="_u_s_b__host.html#USBH_User_Code_Implementation">Application Code</a> using code templates that are provided to support various USB Device Classes.</li>
<li><a class="el" href="_u_s_b__host.html#usbh_debugging">Debug</a> you application using the built-in mechanisms of the USB Component.</li>
</ol>
<h2><a class="anchor" id="RTE_Software_Component_Selection_USBH"></a>
RTE Component Selection</h2>
<p>The RTE Component selection is done in a few steps:</p>
<ol type="1">
<li>From the USB Component:<ul>
<li>Select <b>USB:CORE</b> that provides the basic functionality required for USB communication.</li>
<li>Set <b>USB:Host</b> to '1'. This creates one USB Host for communication with attached USB Devices.</li>
<li>Select the desired support for USB Classes (HID/MSC/CDC/Custom Class). For example, select <b>USB:Host:HID</b> to support HID Class Devices only.</li>
</ul>
</li>
<li>From the Drivers Component:<ul>
<li>Select an appropriate USB Host driver suitable for your application.</li>
</ul>
</li>
<li>From the Device Component:<ul>
<li>Additional device specific drivers may be required according to the validation output.</li>
</ul>
</li>
<li>From the CMSIS Component:<ul>
<li>Select the <b>CMSIS:CORE</b> to provide the core interface to the processor.</li>
<li>Select a suitable <b>CMSIS:RTOS</b> or <b>CMSIS:RTOS2</b> that is a required for the application.</li>
</ul>
</li>
</ol>
<div class="image">
<img src="USBH_RTE.png" alt="USBH_RTE.png"/>
<div class="caption">
RTE Component Selection</div></div>
<h2><a class="anchor" id="USB_Driver_Configuration_USBH"></a>
USB Driver and Controller</h2>
<p>The USB Host Driver and the USB Controller of the microcontroller need to be correctly configured. In particular this means:</p>
<ul>
<li>The USB Host Driver selected under the Drivers Component is typically configured with the <b>RTE_Device.h</b> configuration file. While this file provides multiple options, it is typically sufficient to enable the USB Host peripheral related to this driver. Some microcontrollers may require settings that related to a physical layer interface <b></b>(PHY), the USB <b>VBUS</b> power and <b>Overcurrent</b> protection.</li>
<li>The USB Controller of the microcontroller needs typically specific clock settings. Consult the user's guide of the microcontroller to understand the requirements. Alternatively you may copy the setup of an USB Host example that is provided for various evaluation boards.</li>
</ul>
<h2><a class="anchor" id="USB_Host_Configuration_USBH"></a>
USB Host Configuration</h2>
<p>The <b>USBH_Config_<em>n</em>.c</b> file contains additional settings for the specific USB Host:</p>
<ul>
<li>The <b>Driver</b> <b>Number</b> is set according to the selected USB Controller. For single USB Device Controllers it will be '0'.</li>
<li>Some microcontrollers can make use of different hardware <b>Controller</b> <b>Interfaces</b>. Consult the user's guide of the selected microcontroller to choose the correct setting.</li>
</ul>
<p>Refer to <a class="el" href="group__usbh__core_functions__conf.html">Configuration</a> for a detailed list of all available settings.</p>
<h2><a class="anchor" id="usbh_system_resources"></a>
System Resource Configuration</h2>
<p>For proper operation, the USB Host Component requires some system configuration settings. The requirements are:</p>
<ul>
<li>Additional <b>stack</b> size of <b>512 bytes</b>. This can be configured in the device's <script>link_ext('startup_device');</script> file (<code>Stack_Size</code>).</li>
<li>The USB Device Component uses CMSIS-RTOS threads. In case <b>RTX v5</b> is used <b>no changes to RTX settings</b> are necessary as all resources are allocated statically. In case <b>RTX v4</b> is used you need to change following settings in <script>link_ext('RTX-Conf-CM4');</script> file:<ul>
<li>Increase the <b>Number of concurrent running user threads</b> by number of threads required by USB Host</li>
<li>Increase the <b>Number of threads with user-provided stack size</b> by number of threads required by USB Host</li>
<li>Increase <b>Total stack size [bytes] for threads with user-provided stack size</b> by size of threads required by USB Host</li>
<li>Enable <b>User Timers</b></li>
</ul>
</li>
</ul>
<p>For more information, check the USB Host component's <a class="el" href="usb_resource_requirements.html#usbh_res_req">Resource Requirements</a> section.</p>
<h2><a class="anchor" id="USB_Device_Class_Configuration_USBH"></a>
Configuration of Attachable USB Devices</h2>
<p>In the <b>USBH_Config_HID.h</b>, <b>USBH_Config_MSC.h</b>, <b>USBH_Config_CDC.h</b>, or <b>USBH_Config_CustomClass.h</b> you can specify the number of concurrent USB Devices that the USB Host will support. This has an impact on the amount of memory that will be reserved in your application for the attachment of USB Devices. The <a class="el" href="_u_s_b__host__tutorial.html">Examples</a> shows how to configure an USB Host to interact with different HID, MSC or CDC peripheral devices.</p>
<h2><a class="anchor" id="USBH_User_Code_Implementation"></a>
User Code Implementation</h2>
 <script>link_ext('uv4_ca_sourcefiles');</script> files provide function templates to support various USB Device Classes on the USB Host. The available functions are explained in the <a class="el" href="group__usbh___dev_class_functions.html">Reference</a> section of the USB Host Component. These routines can be adapted to the needs of the microcontroller application, in case different then default functionality is needed.</p>
<p>The following templates are available for the USB Host component: </p>
<table class="doxtable">
<tr>
<th>Template Name </th><th>Purpose  </th></tr>
<tr>
<td>USBH_MSC.c </td><td>Required functions to support MSC devices. The template can be found <a class="el" href="group__usbh__msc_functions.html#USBH_MSC_UCT">here</a>. </td></tr>
<tr>
<td>USBH_PL2303.c </td><td>Required functions to support the <a href="http://www.prolific.com.tw/us/ShowProduct.aspx?pcid=41&amp;showlevel=0017-0037-0041" class="el" target="_blank">Prolific PL2303</a> USB to serial RS232 adapter. The template can be found <a class="el" href="group__usbh__custom_functions.html#USBH_PL2303_UCT">here</a>. </td></tr>
<tr>
<td>USBH_User_CustomClass.c </td><td>Required functions to support any USB Device class. The template can be found <a class="el" href="group__usbh__custom_functions.html#USBH_Cust_UCT">here</a>. </td></tr>
</table>
<h2><a class="anchor" id="usbh_debugging"></a>
Debugging</h2>
<p>USB Host Component is distributed in library form and doesn't allow its direct code debug. However it can be easily configured to generate debug events and provide dynamic visibility to the component operation.</p>
<p>Following variants can be selected for the <b>USB:CORE</b> software component in the <b>Manage Run-Time Environment</b> window:</p>
<ul>
<li><b>Debug</b>: this variant supports event annotations for the <script>link_ext('Event-Recorder-About');</script> and makes it very easy to analyze the internal operation of the USB Host Component during application debug. <a class="el" href="_u_s_b__host.html#usbHostEvrSupport">Event Recorder Support</a> below explains how to configure and use this variant.</li>
<li><b>Release</b>: this variant does not include additional debugging code. Use this variant when deploying the application.</li>
</ul>
<p>The figure below shows selection of the <b>Debug</b> variant. </p>
<div class="image">
<img src="usbh_debug_variant.png" alt="usbh_debug_variant.png"/>
</div>
<p>The <a class="el" href="group__usbh__evr.html">USB Host:Debug Events</a> describes the events implemented in the USB Device Component.</p>
<p><a class="anchor" id="usbHostEvrSupport"></a></p>
<h2>Event Recorder Support </h2>
 <script>link_ext('Event-Recorder-About');</script> is a powerful tool that provides visibility to the dynamic execution of the program.</p>
<p>The USB Host Component generates <a class="el" href="group__usbh__evr.html">a broad set of Debug Events</a> for the Event Recorder and implements required infrastructure to interface with it.</p>
<p>To use the Event Recorder it is required to create an image with event generation support. The necessary steps are:</p>
<ol type="1">
<li> <script>link_ext('Debug-Variant-Select');</script>: in the RTE management dialog select the <b>Debug</b> variant for the <b>USB:CORE</b> software component.</li>
<li> <script>link_ext('Event-Recorder-Enable');</script>: in the RTE management dialog enable the software component <b>Compiler:Event Recorder</b>.</li>
<li>Ensure that Event Recorder is initialized preferably by <script>link_ext('RTX5-Event-Recorder-Config');</script> if CMSIS-RTOS2 RTX v5 is used, or alternatively by calling the function <script>link_ext('Event-Recorder-Initialize-Func');</script> in the application code.</li>
<li><a class="el" href="_u_s_b__host.html#usbHostEvrConfig">Event Recorder Configuration</a>: if necessary, adjust default Event Recorder configuration.</li>
<li>Build the application code, download it to the target hardware and start debug session.</li>
</ol>
<p>Now, when the USB Host generates event information, it can be viewed in the <script>link_ext('uv4-Event-Recorder');</script>.</p>
<p><a class="anchor" id="usbHostEvrConfig"></a></p>
<h2>Event Recorder Configuration </h2>
<p>This section describes the configuration settings for the Event Recorder. The usage requires the debug variant of the <b>USB:CORE</b> software component; refer to <a class="el" href="_u_s_b__host.html#usbHostEvrSupport">Event Recorder Support</a> for more information.</p>
<p><b>USB Event Generation Configuration</b></p>
<p>Selecting the <b>USB:CORE</b> debug variant will add the file <code>USB_Debug.c</code> to your project. Use this file to set the event generation configuration for USB core, drivers, and device classes separately. The file is available for USB Device and Host components.</p>
<div class="image">
<img src="USBH_USB_Debug_c.png" alt="USBH_USB_Debug_c.png"/>
<div class="caption">
USB_Debug.c file for event generation configuration</div></div>
<p> The following settings are available for event generation configuration of each module:</p>
<ul>
<li><b>Off</b> means no events will be generated by the module</li>
<li><b>Errors</b> means only error events will be generated by the module</li>
<li><b>Errors + API</b> means error and API call events will be generated by the module</li>
<li><b>All</b> means all available events will be generated by the module. Besides error and API call events, this contains operation and detailed events.</li>
</ul>
<p><b>Event IDs</b></p>
<p>The USB Host component uses the following event IDs: </p>
<table class="doxtable">
<tr>
<th>Component </th><th>Event ID  </th></tr>
<tr>
<td>USBH_Core </td><td>0xB0 </td></tr>
<tr>
<td>USBH_Driver </td><td>0xB1 </td></tr>
<tr>
<td>USBH_CC </td><td>0xB2 </td></tr>
<tr>
<td>USBH_CDC </td><td>0xB3 </td></tr>
<tr>
<td>USBH_HID </td><td>0xB4 </td></tr>
<tr>
<td>USBH_MSC </td><td>0xB5 </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue May 25 2021 13:57:46 for USB Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
